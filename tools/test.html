<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Floor Heating • Live Window (Mock)</title>
    <style>
      :root {
        --bg0: #05090b;
        --bg1: #070f12;
        --panel: #071215cc;
        --panel2: #061114a6;

        --mint: #00ffae;
        --mint2: #19e6c0;
        --cyan: #3fdcff;

        --ok: #00ffae;
        --off: #8a8f96;
        --nowire: #3fdcff;

        --warn: #f7d14a;
        --err: #ff5050;
        --blue: #37a7ff;

        --stroke: rgba(0, 255, 174, 0.26);
        --stroke2: rgba(0, 255, 174, 0.16);

        --text: rgba(233, 254, 247, 0.92);
        --muted: rgba(233, 254, 247, 0.62);
        --muted2: rgba(233, 254, 247, 0.38);

        --r: 26px; /* port radius-ish */
        --dot: 18px; /* small state dot size */
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        display: grid;
        place-items: center;
        background:
          radial-gradient(
            1100px 600px at 50% 15%,
            rgba(0, 255, 174, 0.12),
            transparent 55%
          ),
          radial-gradient(
            900px 520px at 50% 100%,
            rgba(0, 255, 174, 0.08),
            transparent 60%
          ),
          linear-gradient(180deg, var(--bg1), var(--bg0));
        color: var(--text);
        font-family:
          Inter,
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        padding: 18px;
      }

      /* Wrapper */
      .live-ui {
        width: min(980px, 96vw);
      }

      /* Legend bar */
      .legend-wrap {
        display: flex;
        justify-content: center;
        margin-bottom: 14px;
      }
      .legend {
        display: flex;
        gap: 14px;
        padding: 10px 18px;
        border-radius: 999px;
        border: 1px solid rgba(0, 255, 174, 0.18);
        background:
          radial-gradient(
            circle at 40% 0%,
            rgba(0, 255, 174, 0.1),
            transparent 60%
          ),
          rgba(3, 6, 8, 0.72);
        box-shadow:
          0 18px 46px rgba(0, 0, 0, 0.6),
          0 0 18px rgba(0, 255, 174, 0.06);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
      }
      .legend-pill {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: rgba(233, 254, 247, 0.82);
        letter-spacing: 0.2px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: rgba(255, 255, 255, 0.02);
        white-space: nowrap;
      }
      .legend-led {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        box-shadow:
          0 0 0 3px rgba(255, 255, 255, 0.04),
          0 0 12px currentColor;
      }
      .legend-pill[data-kind="on"] {
        color: var(--ok);
      }
      .legend-pill[data-kind="off"] {
        color: rgba(210, 216, 224, 0.72);
      }
      .legend-pill[data-kind="nw"] {
        color: var(--nowire);
      }

      /* Stage */
      .stage {
        position: relative;
        height: 560px;
        border-radius: 34px;
        border: 1px solid rgba(0, 255, 174, 0.12);
        background:
          radial-gradient(
            520px 360px at 50% 45%,
            rgba(0, 255, 174, 0.09),
            transparent 55%
          ),
          radial-gradient(
            720px 540px at 50% 20%,
            rgba(255, 255, 255, 0.04),
            transparent 55%
          ),
          rgba(2, 6, 8, 0.68);
        box-shadow:
          0 24px 70px rgba(0, 0, 0, 0.78),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
        overflow: hidden;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      /* Wiring (behind everything) */
      .wiring {
        position: absolute;
        inset: 0;
        z-index: 1;
        opacity: 0.65;
        filter: drop-shadow(0 0 10px rgba(0, 255, 174, 0.08));
        pointer-events: none;
      }

      /* Port rows */
      .port-row {
        position: absolute;
        top: var(--y);
        z-index: 3;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .port-row.left {
        left: 120px;
      }
      .port-row.right {
        right: 120px;
        flex-direction: row-reverse;
      }

      .state-dot {
        width: var(--dot);
        height: var(--dot);
        border-radius: 50%;
        background: rgba(180, 186, 194, 0.55);
        box-shadow:
          0 0 0 6px rgba(255, 255, 255, 0.02),
          0 0 0 1px rgba(255, 255, 255, 0.06);
      }
      .state-dot[data-state="on"] {
        background: var(--ok);
        box-shadow:
          0 0 0 6px rgba(0, 255, 174, 0.08),
          0 0 0 1px rgba(0, 255, 174, 0.22),
          0 0 18px rgba(0, 255, 174, 0.3);
      }
      .state-dot[data-state="off"] {
        background: rgba(160, 168, 176, 0.55);
        box-shadow:
          0 0 0 6px rgba(255, 255, 255, 0.02),
          0 0 0 1px rgba(255, 255, 255, 0.06);
      }
      .state-dot[data-state="nowire"] {
        background: var(--nowire);
        box-shadow:
          0 0 0 6px rgba(63, 220, 255, 0.08),
          0 0 0 1px rgba(63, 220, 255, 0.22),
          0 0 18px rgba(63, 220, 255, 0.28);
      }

      .port {
        width: calc(var(--r) * 2);
        height: calc(var(--r) * 2);
        border-radius: 999px;
        border: 1.6px solid rgba(0, 255, 174, 0.35);
        background:
          radial-gradient(
            circle at 30% 25%,
            rgba(0, 255, 174, 0.08),
            transparent 55%
          ),
          rgba(5, 10, 12, 0.86);
        color: rgba(233, 254, 247, 0.75);
        display: grid;
        place-items: center;
        font-weight: 700;
        font-size: 18px;
        letter-spacing: 0.4px;
        box-shadow:
          inset 0 1px 0 rgba(255, 255, 255, 0.06),
          0 0 0 1px rgba(0, 255, 174, 0.1),
          0 0 16px rgba(0, 255, 174, 0.1);
        cursor: pointer;
        transition:
          transform 0.16s ease,
          box-shadow 0.16s ease,
          border-color 0.16s ease;
        user-select: none;
      }
      .port:hover {
        transform: translateY(-1px);
        border-color: rgba(0, 255, 174, 0.55);
        box-shadow:
          inset 0 1px 0 rgba(255, 255, 255, 0.06),
          0 0 0 1px rgba(0, 255, 174, 0.14),
          0 0 22px rgba(0, 255, 174, 0.16);
      }
      .port:active {
        transform: translateY(0);
      }

      /* Temperature bubble (looks like the “23” circle) */
      .temp {
        font-size: 14px;
        font-weight: 800;
        color: rgba(233, 254, 247, 0.88);
        letter-spacing: 0.2px;
      }

      /* Bottom dots */
      .bottom-dot {
        position: absolute;
        top: 485px;
        z-index: 3;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.02);
      }
      .bottom-dot.ac {
        left: 128px;
        background: #ff3b3b;
        box-shadow:
          0 0 0 10px rgba(255, 59, 59, 0.06),
          0 0 0 1px rgba(255, 59, 59, 0.3),
          0 0 26px rgba(255, 59, 59, 0.28);
      }
      .bottom-dot.relay {
        right: 128px;
        background: rgba(160, 168, 176, 0.55);
        box-shadow:
          0 0 0 10px rgba(255, 255, 255, 0.02),
          0 0 0 1px rgba(255, 255, 255, 0.06);
      }
      .bottom-dot.relay.is-on {
        background: var(--warn);
        box-shadow:
          0 0 0 10px rgba(247, 209, 74, 0.06),
          0 0 0 1px rgba(247, 209, 74, 0.28),
          0 0 24px rgba(247, 209, 74, 0.22);
      }

      /* Session card (DROP-IN, merged + fixed) */
      .card {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 4;

        width: 340px;
        padding: 16px 16px 14px;

        border-radius: 22px;
        border: 1px solid rgba(0, 255, 174, 0.22);
        background:
          radial-gradient(
            circle at 20% 0%,
            rgba(0, 255, 174, 0.14),
            transparent 60%
          ),
          rgba(3, 8, 10, 0.78);

        box-shadow:
          0 24px 70px rgba(0, 0, 0, 0.72),
          0 0 22px rgba(0, 255, 174, 0.08);

        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);

        /* ✅ Watermark support */
        overflow: hidden; /* keeps watermark inside rounded card */
        isolation: isolate; /* clean z-index layering */
      }

      /* --- Card watermark (resistor + rings) --- */
      .card-watermark {
        position: absolute;
        left: 50%;
        top: 54%;
        transform: translate(-50%, -50%);
        width: 92%;
        height: 92%;
        opacity: 0.1; /* tweak 0.08–0.14 */
        pointer-events: none;
        z-index: 0;
        filter: drop-shadow(0 0 18px rgba(0, 255, 174, 0.1));
      }

      /* Wrap all card content in .card-inner so it sits above the watermark */
      .card-inner {
        position: relative;
        z-index: 2;
      }

      /* Existing header styles */
      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 10px;
      }

      .card-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 900;
        letter-spacing: 1.1px;
        color: rgba(0, 255, 174, 0.78);
        font-size: 14px;
        text-transform: uppercase;
      }

      .mini-pill {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.02);
        font-size: 12px;
        color: rgba(233, 254, 247, 0.84);
      }
      .mini-led {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--ok);
        box-shadow: 0 0 14px rgba(0, 255, 174, 0.3);
      }

      .card-sub {
        font-size: 12.5px;
        color: rgba(233, 254, 247, 0.55);
        margin: 6px 0 12px;
      }

      .metrics {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 12px;
      }
      .metric {
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: rgba(255, 255, 255, 0.02);
        padding: 10px 10px;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        min-height: 56px;
      }
      .metric-top {
        display: flex;
        align-items: center;
        gap: 8px;
        color: rgba(233, 254, 247, 0.55);
        font-size: 12px;
      }
      .metric-val {
        margin-top: 6px;
        font-weight: 900;
        letter-spacing: 0.3px;
        color: rgba(233, 254, 247, 0.86);
        font-size: 14px;
      }
      .metric small {
        color: rgba(233, 254, 247, 0.38);
        font-weight: 700;
      }

      .actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }

      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        height: 34px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.02);
        color: rgba(233, 254, 247, 0.82);
        font-size: 12px;
        font-weight: 800;
        cursor: pointer;
        transition:
          transform 0.16s ease,
          box-shadow 0.16s ease,
          border-color 0.16s ease;
        user-select: none;
      }
      .btn:hover {
        transform: translateY(-1px);
        border-color: rgba(0, 255, 174, 0.3);
        box-shadow: 0 0 14px rgba(0, 255, 174, 0.1);
      }
      .btn:active {
        transform: translateY(0);
      }

      .btn[data-kind="cal"] {
        border-color: rgba(247, 209, 74, 0.18);
        color: rgba(247, 209, 74, 0.92);
      }
      .btn[data-kind="cal"]:hover {
        border-color: rgba(247, 209, 74, 0.34);
        box-shadow: 0 0 14px rgba(247, 209, 74, 0.1);
      }

      .btn[data-kind="live"] {
        border-color: rgba(55, 167, 255, 0.18);
        color: rgba(55, 167, 255, 0.92);
      }
      .btn[data-kind="live"]:hover {
        border-color: rgba(55, 167, 255, 0.34);
        box-shadow: 0 0 14px rgba(55, 167, 255, 0.1);
      }

      .btn[data-kind="err"] {
        border-color: rgba(255, 80, 80, 0.18);
        color: rgba(255, 80, 80, 0.92);
      }
      .btn[data-kind="err"]:hover {
        border-color: rgba(255, 80, 80, 0.34);
        box-shadow: 0 0 14px rgba(255, 80, 80, 0.1);
      }

      .btn[data-kind="log"] {
        grid-column: 2 / 3;
        width: 110px;
        justify-self: end;
        border-color: rgba(55, 167, 255, 0.18);
        color: rgba(180, 220, 255, 0.92);
      }

      /* Small inline icons */
      .ico {
        width: 14px;
        height: 14px;
        display: inline-block;
      }
      .ico svg {
        width: 14px;
        height: 14px;
        display: block;
      }

      /* Helpful: make it look crisp */
      @media (max-width: 860px) {
        .stage {
          height: 620px;
        }
        .port-row.left {
          left: 70px;
        }
        .port-row.right {
          right: 70px;
        }
        .bottom-dot.ac {
          left: 78px;
        }
        .bottom-dot.relay {
          right: 78px;
        }
      }
    </style>
  </head>

  <body>
    <div class="live-ui">
      <div class="legend-wrap">
        <div class="legend" role="group" aria-label="Output state legend">
          <div class="legend-pill" data-kind="on">
            <span class="legend-led" style="color: var(--ok)"></span> ON
            (energized)
          </div>
          <div class="legend-pill" data-kind="off">
            <span
              class="legend-led"
              style="color: rgba(180, 186, 194, 0.8)"
            ></span>
            OFF (connected)
          </div>
          <div class="legend-pill" data-kind="nw">
            <span class="legend-led" style="color: var(--nowire)"></span> No
            wire / Not connected
          </div>
        </div>
      </div>

      <div class="stage" id="stage">
        <!-- Wiring lines (static, just for the “look”) -->
        <svg class="wiring" viewBox="0 0 980 560" aria-hidden="true">
          <defs>
            <!-- soft glow without drawing duplicate lines -->
            <filter id="wireGlow" x="-30%" y="-30%" width="160%" height="160%">
              <feGaussianBlur stdDeviation="3" result="b" />
              <feComponentTransfer in="b" result="bg">
                <feFuncA type="linear" slope="0.35" />
              </feComponentTransfer>
              <feMerge>
                <feMergeNode in="bg" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>

          <g
            filter="url(#wireGlow)"
            fill="none"
            stroke="rgba(0,255,174,.22)"
            stroke-width="3"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <!-- LEFT branch lines: from left port inner edge -> left bus -->
            <path d="M210 110 C270 110 320 110 380 110" />
            <path d="M210 175 C270 175 320 175 380 175" />
            <path d="M210 240 C270 240 320 240 380 240" />
            <path d="M210 305 C270 305 320 305 380 305" />
            <path d="M210 370 C270 370 320 370 380 370" />

            <!-- RIGHT branch lines: from right port inner edge -> right bus -->
            <path d="M770 110 C710 110 660 110 600 110" />
            <path d="M770 175 C710 175 660 175 600 175" />
            <path d="M770 240 C710 240 660 240 600 240" />
            <path d="M770 305 C710 305 660 305 600 305" />
            <path d="M770 370 C710 370 660 370 600 370" />

            <!-- Bus-to-center connections (a clean “manifold” into the controller) -->
            <path d="M380 250 C420 250 450 250 490 250" />
            <path d="M600 250 C560 250 530 250 490 250" />
            <path d="M380 330 C420 330 450 330 490 330" />
            <path d="M600 330 C560 330 530 330 490 330" />

            <!-- Bottom feeds (to AC dot + relay dot) -->
            <path d="M143 500 H380 V420 H600" />
            <path d="M837 500 H600 V420 H400" />

            <!-- Junction dots (subtle) -->
            <g fill="rgba(0,255,174,.18)" stroke="rgba(0,255,174,.18)">
              <circle cx="380" cy="110" r="3" />
              <circle cx="380" cy="175" r="3" />
              <circle cx="380" cy="240" r="3" />
              <circle cx="380" cy="305" r="3" />
              <circle cx="380" cy="370" r="3" />

              <circle cx="600" cy="110" r="3" />
              <circle cx="600" cy="175" r="3" />
              <circle cx="600" cy="240" r="3" />
              <circle cx="600" cy="305" r="3" />
              <circle cx="600" cy="370" r="3" />

              <circle cx="490" cy="250" r="3.2" />
              <circle cx="490" cy="330" r="3.2" />
            </g>
          </g>
        </svg>

        <!-- LEFT OUTPUTS (dot + port) -->
        <div class="port-row left" style="--y: 84px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="L1"
            aria-label="Left output 1"
          >
            –
          </button>
        </div>
        <div class="port-row left" style="--y: 149px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="L2"
            aria-label="Left output 2"
          >
            –
          </button>
        </div>
        <div class="port-row left" style="--y: 214px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="L3"
            aria-label="Left output 3"
          >
            –
          </button>
        </div>
        <div class="port-row left" style="--y: 279px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="L4"
            aria-label="Left output 4"
          >
            –
          </button>
        </div>
        <div class="port-row left" style="--y: 344px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="L5"
            aria-label="Left output 5"
          >
            –
          </button>
        </div>

        <!-- RIGHT OUTPUTS (port + dot) -->
        <div class="port-row right" style="--y: 84px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="R1"
            aria-label="Right output 1"
          >
            –
          </button>
        </div>
        <div class="port-row right" style="--y: 149px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="R2"
            aria-label="Right output 2"
          >
            –
          </button>
        </div>
        <div class="port-row right" style="--y: 214px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="R3"
            aria-label="Right output 3"
          >
            –
          </button>
        </div>
        <div class="port-row right" style="--y: 279px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port"
            type="button"
            data-port="R4"
            aria-label="Right output 4"
          >
            –
          </button>
        </div>

        <!-- Temperature bubble example (like the "23") -->
        <div class="port-row right" style="--y: 344px">
          <span class="state-dot" data-state="off"></span>
          <button
            class="port temp"
            type="button"
            data-temp="wire-5"
            aria-label="Wire temperature"
          >
            23
          </button>
        </div>

        <!-- Bottom input dots -->
        <div
          class="bottom-dot ac"
          title="AC Input Connected"
          aria-label="AC input connected"
        ></div>
        <div
          class="bottom-dot relay"
          id="relayDot"
          title="Relay state"
          aria-label="Relay state"
        ></div>

        <!-- Center session card -->
        <section class="card" aria-label="Current session live panel">
          <!-- ✅ ADD THIS SVG FIRST (watermark behind everything) -->
          <svg class="card-watermark" viewBox="0 0 240 240" aria-hidden="true">
            <!-- two rings -->
            <circle
              cx="120"
              cy="120"
              r="92"
              fill="none"
              stroke="rgba(0,255,174,.55)"
              stroke-width="3"
            />
            <circle
              cx="120"
              cy="120"
              r="62"
              fill="none"
              stroke="rgba(0,255,174,.35)"
              stroke-width="3"
            />

            <!-- resistor symbol (zigzag) -->
            <path
              d="M42 120h28
         l10-14 10 28 10-28 10 28 10-28 10 28 10-28 10 28 10-14
         h28"
              fill="none"
              stroke="rgba(0,255,174,.55)"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
            />

            <!-- small terminals (optional, looks nice) -->
            <circle cx="42" cy="120" r="4" fill="rgba(0,255,174,.55)" />
            <circle cx="198" cy="120" r="4" fill="rgba(0,255,174,.55)" />
          </svg>

          <!-- ✅ WRAP ALL YOUR EXISTING CARD CONTENT IN .card-inner -->
          <div class="card-inner">
            <div class="card-header">
              <div class="card-title">
                <span class="ico" aria-hidden="true">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 18V6"></path>
                    <path d="M4 18h16"></path>
                    <path d="M8 14l3-3 3 2 6-6"></path>
                  </svg>
                </span>
                CURRENT SESSION
              </div>
              <div class="mini-pill" aria-label="Live status">
                <span class="mini-led"></span> LIVE
              </div>
            </div>

            <div class="card-sub" id="sessionState">No active session</div>

            <div class="metrics">
              <div class="metric">
                <div class="metric-top">
                  <span class="ico" aria-hidden="true">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"></path>
                    </svg>
                  </span>
                  Energy
                </div>
                <div class="metric-val">
                  <span id="mEnergy">–</span> <small>Wh</small>
                </div>
              </div>

              <div class="metric">
                <div class="metric-top">
                  <span class="ico" aria-hidden="true">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <circle cx="12" cy="12" r="9"></circle>
                      <path d="M12 7v6l4 2"></path>
                    </svg>
                  </span>
                  Duration
                </div>
                <div class="metric-val">
                  <span id="mDur">–</span> <small>s</small>
                </div>
              </div>

              <div class="metric">
                <div class="metric-top">
                  <span class="ico" aria-hidden="true">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M4 19V5"></path>
                      <path d="M8 19V9"></path>
                      <path d="M12 19V12"></path>
                      <path d="M16 19V7"></path>
                      <path d="M20 19V10"></path>
                    </svg>
                  </span>
                  Peak Power
                </div>
                <div class="metric-val">
                  <span id="mPwr">–</span> <small>W</small>
                </div>
              </div>

              <div class="metric">
                <div class="metric-top">
                  <span class="ico" aria-hidden="true">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M3 12h6l3-8 4 16 3-8h5"></path>
                    </svg>
                  </span>
                  Peak Current
                </div>
                <div class="metric-val">
                  <span id="mCur">–</span> <small>A</small>
                </div>
              </div>
            </div>

            <div class="actions">
              <button class="btn" type="button" id="btnHistory">
                <span class="ico" aria-hidden="true">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 4h16"></path>
                    <path d="M4 10h16"></path>
                    <path d="M4 16h16"></path>
                  </svg>
                </span>
                History
              </button>

              <button class="btn" type="button" data-kind="cal" id="btnCal">
                <span class="ico" aria-hidden="true">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 12h16"></path>
                    <path d="M6 8h12"></path>
                    <path d="M8 16h8"></path>
                  </svg>
                </span>
                Calibration
              </button>

              <button class="btn" type="button" data-kind="live" id="btnLive">
                <span class="ico" aria-hidden="true">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 12a8 8 0 0 1 16 0"></path>
                    <path d="M7 12a5 5 0 0 1 10 0"></path>
                    <circle
                      cx="12"
                      cy="12"
                      r="1.2"
                      fill="currentColor"
                      stroke="none"
                    ></circle>
                  </svg>
                </span>
                Live Control
              </button>

              <button class="btn" type="button" data-kind="err" id="btnErr">
                <span class="ico" aria-hidden="true">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M12 9v4"></path>
                    <path d="M12 17h.01"></path>
                    <path
                      d="M10.3 4.3h3.4l7 12.2a2 2 0 0 1-1.7 3H5a2 2 0 0 1-1.7-3l7-12.2z"
                    ></path>
                  </svg>
                </span>
                Error
              </button>

              <button class="btn" type="button" data-kind="log" id="btnLog">
                <span class="ico" aria-hidden="true">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                    ></path>
                    <path d="M14 2v6h6"></path>
                    <path d="M8 13h8"></path>
                    <path d="M8 17h6"></path>
                  </svg>
                </span>
                Log
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script>
      // Mock logic: click any port to cycle states: off -> on -> nowire -> off
      // Also mock a "live session" that starts when relay is toggled.
      const cycle = ["off", "on", "nowire"];

      function nextState(s) {
        const i = cycle.indexOf(s);
        return cycle[(i + 1) % cycle.length];
      }

      // Attach to each port row: dot changes, port stays same look (like screenshot)
      document.querySelectorAll(".port-row").forEach((row) => {
        const dot = row.querySelector(".state-dot");
        const port = row.querySelector(".port");
        if (!dot || !port) return;

        port.addEventListener("click", () => {
          const current = dot.getAttribute("data-state") || "off";
          const n = nextState(current);
          dot.setAttribute("data-state", n);

          // If it's the temp bubble, keep number (but update randomly for fun)
          if (port.classList.contains("temp")) {
            port.textContent = String(18 + Math.floor(Math.random() * 20));
          }
        });
      });

      // Relay dot toggles live session
      const relayDot = document.getElementById("relayDot");
      const sessionState = document.getElementById("sessionState");
      const mEnergy = document.getElementById("mEnergy");
      const mDur = document.getElementById("mDur");
      const mPwr = document.getElementById("mPwr");
      const mCur = document.getElementById("mCur");

      let running = false;
      let t0 = 0;
      let timer = null;

      function stopSession() {
        running = false;
        sessionState.textContent = "No active session";
        mEnergy.textContent = "–";
        mDur.textContent = "–";
        mPwr.textContent = "–";
        mCur.textContent = "–";
        clearInterval(timer);
        timer = null;
      }

      function startSession() {
        running = true;
        t0 = Date.now();
        sessionState.textContent = "Session running…";
        clearInterval(timer);
        timer = setInterval(() => {
          const secs = Math.floor((Date.now() - t0) / 1000);
          const peakP = (200 + Math.random() * 600) | 0;
          const peakI = (2 + Math.random() * 10).toFixed(1);
          const wh = (secs * (peakP / 3600) * 0.35).toFixed(1);

          mDur.textContent = secs;
          mPwr.textContent = peakP;
          mCur.textContent = peakI;
          mEnergy.textContent = wh;
        }, 900);
      }

      relayDot.addEventListener("click", () => {
        relayDot.classList.toggle("is-on");
        const on = relayDot.classList.contains("is-on");
        if (on) startSession();
        else stopSession();
      });
      relayDot.style.cursor = "pointer";
      relayDot.title = "Click to toggle relay (mock)";

      // Buttons (mock)
      document.getElementById("btnHistory").onclick = () =>
        alert("History (mock)");
      document.getElementById("btnCal").onclick = () =>
        alert("Calibration (mock)");
      document.getElementById("btnLive").onclick = () =>
        alert("Live Control (mock)");
      document.getElementById("btnErr").onclick = () =>
        alert("Error panel (mock)");
      document.getElementById("btnLog").onclick = () => alert("Log (mock)");

      // Start with "no active session"
      stopSession();
    </script>
  </body>
</html>
