<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Distribution Board Control</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, rgba(12, 12, 12, 0.8), rgba(38, 38, 38, 0.6)), url('background-image.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            transform: scale(0.65); /* Scale everything down to 80% */
            transform-origin: center center; /* Keep it centered */
        }

        h1 {
            text-align: center;
            margin-top: 50px;
            font-size: 2.5em;
            color: #ffffff;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.6);
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 600px;
            height: 1000px;
            padding: 20px;
            box-sizing: border-box;
            overflow: auto;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px; /* Increased border radius */
        }

        .section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px; /* Increased border radius */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease-in-out;
        }

        .section:hover {
            transform: scale(1.05);
        }

        .section h3 {
            text-align: center;
            font-size: 1.5em;
            color: #fff;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 20px; /* Increased border radius */
            margin-top: 10px;
        }

        .progress-bar span {
            display: block;
            height: 100%;
            background-color: #4caf50;
            width: 0;
            border-radius: 20px; /* Increased border radius */
            transition: width 0.5s ease-in-out;
        }

        .button {
            background-color: white; /* Default color */
            color: #333;
            border: 1px solid #ddd;
            padding: 10px;
            width: 100%;
            border-radius: 12px; /* Increased border radius */
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .button.green {
            background-color: #4caf50; /* Green when active */
            border-color: #3e8e41;
        }

        .button.red {
            background-color: #f44336; /* Red when inactive */
            border-color: #e53935;
        }

        .button img {
            width: 32px;
            height: 32px;
            margin-right: 10px;
        }

        .button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

        .button:hover:not(:disabled) {
            background-color: #45a049;
        }

        .toggle-btn {
            margin-top: 15px;
            background-color: #2196F3;
        }

        .toggle-btn:hover:not(:disabled) {
            background-color: #0b7dda;
        }

        .status {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
            text-align: center;
            color: #fff;
        }

        .settings {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .settings input {
            width: 40%;
            padding: 8px;
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px; /* Increased border radius */
            color: #fff;
            text-align: center; /* Center the text inside the input */
        }

        .settings input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.5);
            border-color: #4caf50;
        }

        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
            position: absolute;
            bottom: -170px;
            width: 100%;
        }

        .live-data-monitoring {
            background: rgba(255, 255, 255, 0.9); /* White background with slight transparency */
            color: #333; /* Dark text color for contrast */
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease-in-out;
        }

        .live-data-monitoring h3 {
            text-align: center;
            font-size: 1.5em;
            color: #333; /* Darker color for title */
        }

        .live-data-monitoring .status {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            color: #333; /* Dark color for status text */
        }
        
        /* Temperature section styling */
        .section.temperature h3 {
        display: flex;
        align-items: center;
        justify-content: center;
        }
        .section.temperature h3 img {
        width: 32px;
        height: 32px;
        margin-right: 10px;
        }
        .section.temperature ul {
        list-style: none;
        padding: 0;
        margin: 10px 0 0;
        }
        .section.temperature ul li {
        margin: 5px 0;
        text-align: center;
        font-size: 1.1em;
        }

        /* Make live-data-monitoring span two columns */
        .live-data-monitoring {
        grid-column: span 2;
        }

    </style>
</head>
<body>

  <div class="container">
    <!-- AC Power Status -->
    <div class="section">
      <h3>AC Power Status</h3>
      <div class="status" id="acStatus">
        <img src="icons/ac-power.png" alt="AC Power Icon">
        AC Connected: <span>Loading...</span>
      </div>
    </div>

    <!-- Capacitor Charge Monitoring -->
    <div class="section">
      <h3>Capacitor Charge Status</h3>
      <div class="progress-bar">
        <span id="capacitorCharge" style="width: 0%"></span>
      </div>
      <div class="status" id="capacitorStatus">
        <img src="icons/capacitor.png" alt="Capacitor Icon">
        Charge: 0%
      </div>
    </div>

    <!-- System Power Control -->
    <div class="section">
      <h3>System Power Control</h3>
      <div class="status" id="systemStatus">System is OFF</div>
      <button class="button red" id="powerBtn" onclick="togglePower()">
        <img src="icons/power.png" alt="Power Icon"> Turn ON
      </button>
    </div>

    <!-- Timing Window Settings -->
    <div class="section">
      <h3>Timing Settings</h3>
      <div class="settings">
        <input type="number" id="onTime" placeholder="ON Time (ms)">
        <input type="number" id="offTime" placeholder="OFF Time (ms)">
      </div>
      <button class="button toggle-btn" onclick="updateTiming()">
        <img src="icons/settings-5-16.png" alt="Settings Icon"> Update Timing
      </button>
    </div>

    <!-- LED Feedback -->
    <div class="section">
      <h3>LED Feedback</h3>
      <button class="button toggle-btn" id="ledToggleBtn" onclick="toggleLED()">
        <img src="icons/led.png" alt="LED Icon"> Enable LED Feedback
      </button>
    </div>

    <!-- Temperature Sensors -->
    <div class="section temperature">
      <h3>
        <img src="icons/thermometer.png" alt="Temp Icon">
        Temperature Sensors
      </h3>
      <ul id="tempList">
        <li id="t0">Sensor 0: – °C</li>
        <li id="t1">Sensor 1: – °C</li>
        <li id="t2">Sensor 2: – °C</li>
        <li id="t3">Sensor 3: – °C</li>
      </ul>
    </div>

    <!-- Live Data Monitoring -->
    <div class="section live-data-monitoring">
      <h3>Live Data Monitoring</h3>
      <div class="status" id="liveDataStatus">Live data available</div>
    </div>
  </div>

  <div class="footer">
    &copy; 2025 Power Distribution Board Project
  </div>
    <script>
        let systemPower = false;
        let ledFeedback = false;
    
        // Function to simulate AC Power Status update
        function updateACStatus(status) {
            const acStatusElement = document.getElementById('acStatus');
            let statusColor = 'orange';
            let statusText = 'Unknown';
    
            if (status === true || status === "Connected") {
                statusColor = 'green';
                statusText = 'Connected';
            } else if (status === false || status === "Disconnected") {
                statusColor = 'red';
                statusText = 'Disconnected';
            }
    
            acStatusElement.innerHTML = `<img src="icons/ac-power.png" alt="AC Power Icon"> AC Connected: <span style="color: ${statusColor};">${statusText}</span>`;
        }
    
        // Function to update Capacitor Charge from the ESP32 (using ADC)
        function updateCapacitorCharge(percentage) {
            const progressBar = document.getElementById('capacitorCharge');
            progressBar.style.width = percentage + '%';
            document.getElementById('capacitorStatus').innerHTML = `<img src="icons/capacitor.png" alt="Capacitor Icon"> Charge: ${percentage}%`;
        }
    
        // Function to toggle Power ON/OFF based on charge > 85%
        function togglePower() {
            fetch('/getBatteryStatus')
                .then(response => response.json())
                .then(data => {
                    const batteryStatus = data.battery;
                    if (batteryStatus >= 85) {
                        systemPower = !systemPower;
                        const powerBtn = document.getElementById('powerBtn');
                        const statusText = systemPower ? 'ON' : 'OFF';
                        powerBtn.innerHTML = `<img src="icons/power.png" alt="Power Icon"> Turn ${statusText}`;
                        document.getElementById('systemStatus').innerHTML = `System is ${statusText}`;
                        powerBtn.classList.toggle('green', systemPower);
                        powerBtn.classList.toggle('red', !systemPower);
                    } else {
                        alert('Battery charge must be above 85% to turn ON the system.');
                    }
                });
        }
    
        // Function to update Timing Settings (send to ESP32)
        function updateTiming() {
            const onTime = document.getElementById('onTime').value;
            const offTime = document.getElementById('offTime').value;
            fetch('/setTiming', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ onTime, offTime })
            })
            .then(response => response.json())
            .then(data => {
                alert(`Timing updated: ON Time = ${onTime} ms, OFF Time = ${offTime} ms`);
            });
        }
    
        // Function to toggle LED Feedback (send to ESP32)
        function toggleLED() {
            ledFeedback = !ledFeedback;
            const ledToggleBtn = document.getElementById('ledToggleBtn');
            ledToggleBtn.innerHTML = ledFeedback
                ? `<img src="icons/led.png" alt="LED Icon"> Disable LED Feedback`
                : `<img src="icons/led.png" alt="LED Icon"> Enable LED Feedback`;
            ledToggleBtn.classList.toggle('green', ledFeedback);
            ledToggleBtn.classList.toggle('red', !ledFeedback);
    
            fetch('/toggleLED', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ledFeedback })
            });
        }
    
        // Simulating live data monitoring by fetching it every second
        setInterval(() => {
            fetch('/getACStatus')
                .then(response => response.json())
                .then(data => updateACStatus(data.acStatus));
    
            fetch('/getCapacitorCharge')
                .then(response => response.json())
                .then(data => updateCapacitorCharge(data.charge));
    
            document.getElementById('liveDataStatus').innerHTML = `Live data available at ${new Date().toLocaleTimeString()}`;
        }, 1000);
    // Temperature update function
    function updateTemperatures() {
      fetch('/getTemperatures')
        .then(res => res.json())
        .then(data => {
          data.temperatures.forEach((temp, i) => {
            document.getElementById(`t${i}`)
              .textContent = `Sensor ${i}: ${temp.toFixed(1)} °C`;
          });
        })
        .catch(err => console.error('Temp fetch error:', err));
    }

    // Live data polling
    setInterval(() => {
      fetch('/getACStatus')
        .then(r => r.json()).then(d => updateACStatus(d.acStatus));
      fetch('/getCapacitorCharge')
        .then(r => r.json()).then(d => updateCapacitorCharge(d.charge));
      updateTemperatures(); // fetch & display temperatures
      document.getElementById('liveDataStatus').textContent =
        `Live data at ${new Date().toLocaleTimeString()}`;
    }, 1000);
    </script>
    
</body>
</html>
