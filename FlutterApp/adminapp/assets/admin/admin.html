<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="css/admin.css?v=6" />
  </head>
  <body>
    <div class="ui-container">
      <!-- Global User Icon / Menu -->
      <div class="user-status-global">
        <div class="status-dot" title="Auto Mode"></div>
        <div id="wifiSignal" class="wifi-signal" title="WiFi signal">
          <img
            id="wifiSignalIcon"
            src="icons/wifi-0-bars.png"
            alt="WiFi signal"
          />
        </div>
        <div id="boardTempChip" class="temp-chip" title="Board temperature">
          <img src="icons/thermoBoard.png" alt="Board temp" />
          <span id="boardTempText">--?C</span>
        </div>
        <div
          id="heatsinkTempChip"
          class="temp-chip"
          title="Heatsink temperature"
        >
          <img src="icons/thermoHeatsink.png" alt="Heatsink temp" />
          <span id="heatsinkTempText">--?C</span>
        </div>
        <div id="dcVoltageChip" class="temp-chip" title="DC bus voltage">
          <span class="chip-label">DC</span>
          <span id="dcVoltageText">--V</span>
        </div>
        <div id="dcCurrentChip" class="temp-chip" title="DC current">
          <span class="chip-label">I</span>
          <span id="dcCurrentText">--A</span>
        </div>
        <div id="eventBadge" class="event-badge" title="New warnings/errors">
          <span
            id="eventWarnBtn"
            class="event-pill warn"
            role="button"
            tabindex="0"
          >
            <img src="icons/Warning.png" alt="Warning" />
            <span id="eventWarnCount">0</span>
          </span>
          <span
            id="eventErrBtn"
            class="event-pill err"
            role="button"
            tabindex="0"
          >
            <img src="icons/Error.png" alt="Error" />
            <span id="eventErrCount">0</span>
          </span>
        </div>
        <div id="runModeBadge" class="run-mode-badge" title="Loop running">
          <svg
            class="rm-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="9"></circle>
            <polygon points="11 8 16 12 11 16"></polygon>
          </svg>
          <span class="rm-label">Run</span>
        </div>
        <div
          id="testModeBadge"
          class="test-mode-badge"
          title="Test mode active"
        >
          <svg
            class="tm-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M3 12h4l2-6 4 12 2-6h6"></path>
          </svg>
          <span class="tm-label">TEST MODE</span>
          <span class="tm-mode">--</span>
        </div>
        <div
          id="ambientWaitBadge"
          class="cooldown-badge"
          title="Cooling to ambient"
        >
          <svg
            class="cw-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M6 3h12M6 21h12"></path>
            <path d="M8 7h8l-2.5 4 2.5 4H8l2.5-4L8 7z"></path>
          </svg>
          <span class="cw-label">COOLING</span>
          <span class="cw-mode">--</span>
        </div>
        <div id="statusActions" class="status-actions">
          <button
            id="topStopTestBtn"
            type="button"
            class="status-action-btn status-stop-btn"
            aria-label="Stop active test"
          >
            <svg
              class="status-action-icon"
              viewBox="0 0 24 24"
              aria-hidden="true"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="7" y="7" width="10" height="10" rx="2"></rect>
            </svg>
            <span class="status-action-text">Stop</span>
          </button>
          <button
            id="topCalibBtn"
            type="button"
            class="status-action-btn status-calib-btn"
            aria-label="Open calibration"
          >
            <svg
              class="status-action-icon"
              viewBox="0 0 24 24"
              aria-hidden="true"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="4" y1="6" x2="20" y2="6"></line>
              <circle cx="9" cy="6" r="2"></circle>
              <line x1="4" y1="12" x2="20" y2="12"></line>
              <circle cx="15" cy="12" r="2"></circle>
              <line x1="4" y1="18" x2="20" y2="18"></line>
              <circle cx="11" cy="18" r="2"></circle>
            </svg>
            <span class="status-action-text">Calibration</span>
          </button>
          <button
            id="topLiveControlBtn"
            type="button"
            class="status-action-btn status-live-btn"
            aria-label="Open live control"
          >
            <svg
              class="status-action-icon"
              viewBox="0 0 24 24"
              aria-hidden="true"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M4 20V4"></path>
              <path d="M4 20H20"></path>
              <polyline points="5 14 9 10 13 13 20 7"></polyline>
            </svg>
            <span class="status-action-text">Live Control</span>
          </button>
        </div>
        <div class="user-icon" onclick="toggleUserMenu()">&#128100;</div>
        <div class="user-menu" id="userMenu">
          <button id="disconnectBtn" type="button">Disconnect</button>
        </div>
      </div>


      <div
        id="eventToast"
        class="event-toast"
        role="status"
        aria-live="assertive"
      >
        <div class="event-toast-main">
          <span id="eventToastKind" class="event-toast-kind">ERROR</span>
          <span id="eventToastReason" class="event-toast-reason">--</span>
        </div>
        <button id="eventToastViewBtn" type="button" class="event-toast-btn">
          View
        </button>
      </div>


      <div

        id="setupWizardOverlay"

        class="setup-wizard-overlay"

        aria-hidden="true"

      >

        <div class="setup-wizard-shell">

          <div class="setup-wizard-header">

            <div class="setup-wizard-title">Setup Wizard</div>

            <div id="setupWizardStepTitle" class="setup-wizard-step-title">

              --

            </div>

            <div id="setupWizardStepDesc" class="setup-wizard-step-desc">

              --

            </div>

            <div class="setup-wizard-pill-row">

              <div id="setupWizardConfigPill" class="setup-pill">

                Config: --

              </div>

              <div id="setupWizardCalibPill" class="setup-pill">

                Calibration: --

              </div>

            </div>

          </div>



          <div class="setup-wizard-body">

            <div id="setupWizardRail" class="setup-wizard-rail"></div>

            <div class="setup-wizard-panel">

                            <section id="wizardStepIntro" class="wizard-step">
                <h3>Welcome</h3>
                <p>
                  Complete the required setup steps before running the device.
                </p>
                <div class="wizard-missing-grid">
                  <div>
                    <div class="setup-list-title">Missing config</div>
                    <ul id="wizardMissingConfigList" class="setup-list"></ul>
                  </div>
                  <div>
                    <div class="setup-list-title">Missing calibration</div>
                    <ul id="wizardMissingCalibList" class="setup-list"></ul>
                  </div>
                </div>
              </section>




                            <section id="wizardStepCredentials" class="wizard-step">
                <h3>Credentials</h3>
                <p>
                  Set admin and user accounts. Use the Save buttons in each
                  card.
                </p>
                <div id="wizardMountCredentials" class="wizard-mount"></div>
                <div id="wizardMountUser" class="wizard-mount"></div>
              </section>




                            <section id="wizardStepWifi" class="wizard-step">
                <h3>Wi-Fi</h3>
                <p>Configure the station and access point settings.</p>
                <div id="wizardMountWifiStation" class="wizard-mount"></div>
                <div id="wizardMountWifiAp" class="wizard-mount"></div>
              </section>




                            <section id="wizardStepOutputs" class="wizard-step">
                <h3>Output Selection</h3>
                <p>Select which outputs are enabled for setup and runtime.</p>
                <div id="wizardMountOutputs" class="wizard-mount"></div>
              </section>




                            <section id="wizardStepPresence" class="wizard-step">
                <h3>Presence Check</h3>
                <p>
                  Run the voltage-drop presence probe to confirm connected
                  wires.
                </p>
                <div id="wizardMountPresence" class="wizard-mount"></div>
              </section>




                            <section id="wizardStepNtcParams" class="wizard-step">
                <h3>NTC Parameters</h3>
                <p>Confirm the NTC beta, T0, and resistance values.</p>
                <div class="wizard-mount">
                  <div
                    class="user-modal-content zoom-box settings-card wizard-ntc-card"
                  >
                    <div id="wizardMountNtcParams"></div>
                    <div
                      class="device-settings-actions settings-actions wizard-ntc-actions"
                    >
                      <button
                        type="button"
                        class="settings-btn settings-btn-primary"
                        onclick="saveDeviceAndNichrome()"
                        title="Save NTC parameters"
                      >
                        <svg
                          class="settings-btn-icon"
                          viewBox="0 0 24 24"
                          aria-hidden="true"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="M20 6L9 17l-5-5"></path>
                        </svg>
                        Save NTC
                      </button>
                      <button
                        type="button"
                        class="settings-btn"
                        onclick="resetDeviceAndNichrome()"
                        title="Reset NTC parameters to last loaded values"
                      >
                        <svg
                          class="settings-btn-icon"
                          viewBox="0 0 24 24"
                          aria-hidden="true"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="M3 12a9 9 0 1 0 3-6.7"></path>
                          <polyline points="3 3 3 9 9 9"></polyline>
                        </svg>
                        Reset
                      </button>
                    </div>
                  </div>
                </div>
              </section>




                            <section id="wizardStepDevice" class="wizard-step">
                <h3>Device Settings</h3>
                <p>
                  Fill in the required device, safety, wire, and floor values.
                </p>
                <div id="wizardMountDevice" class="wizard-mount"></div>
              </section>




                            <section id="wizardStepWireCal" class="wizard-step">
                <h3>Wire Calibration</h3>
                <p>
                  Select a wire, start calibration, or skip and return later.
                </p>
                <div class="wizard-calib-status">
                  Status: <span id="wizardWireCalStatus">--</span>
                </div>
                <button
                  id="wizardOpenWireCalBtn"
                  type="button"
                  class="settings-btn settings-btn-primary"
                >
                  Open Calibration
                </button>
              </section>




                            <section id="wizardStepFloorCal" class="wizard-step">
                <h3>Floor Calibration</h3>
                <p>
                  Calibrate the floor model after wire calibration completes.
                </p>
                <div id="wizardFloorGateNote" class="wizard-calib-status">
                  Wire calibration must be complete before floor calibration.
                </div>
                <div class="wizard-floor-actions">
                  <button
                    id="wizardFloorGoWireBtn"
                    type="button"
                    class="settings-btn"
                  >
                    Back to wire calibration
                  </button>
                  <button
                    id="wizardFloorGoNtcBtn"
                    type="button"
                    class="settings-btn"
                  >
                    Edit NTC parameters
                  </button>
                </div>
                <div class="wizard-calib-status">
                  Status: <span id="wizardFloorCalStatus">--</span>
                </div>
                <button
                  id="wizardOpenFloorCalBtn"
                  type="button"
                  class="settings-btn settings-btn-primary"
                >
                  Open Calibration
                </button>
              </section>




                            <section id="wizardStepFinish" class="wizard-step">
                <h3>Finish</h3>
                <p>Confirm setup completion and review calibration status.</p>
                <div class="wizard-summary">
                  <div>
                    Configuration: <span id="wizardSummaryConfig">--</span>
                  </div>
                  <div>
                    Calibration: <span id="wizardSummaryCalib">--</span>
                  </div>
                </div>
              </section>


            </div>

          </div>



          <div class="setup-wizard-footer">

            <div id="setupWizardNote" class="setup-wizard-note">--</div>

            <div class="setup-wizard-actions">

              <button id="wizardBackBtn" type="button" class="settings-btn">

                Back

              </button>

              <button id="wizardSkipBtn" type="button" class="settings-btn">

                Skip for now

              </button>

              <button

                id="wizardNextBtn"

                type="button"

                class="settings-btn settings-btn-primary"

              >

                Next

              </button>

              <button

                id="wizardFinishBtn"

                type="button"

                class="settings-btn settings-btn-primary"

              >

                Finish Setup

              </button>

            </div>

          </div>

        </div>

      </div>




      <!-- Sidebar -->
      <div class="sidebar">
        <div class="tab active" onclick="switchTab(0)">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="3" y1="9" x2="21" y2="9"></line>
            <line x1="9" y1="21" x2="9" y2="9"></line>
          </svg>
          <span>Dashboard</span>
        </div>
        <div class="tab" id="userTabBtn" onclick="switchTab(1)">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span>User</span>
        </div>
        <div class="tab" onclick="switchTab(2)">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="4" y1="21" x2="4" y2="14"></line>
            <line x1="4" y1="10" x2="4" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12" y2="3"></line>
            <line x1="20" y1="21" x2="20" y2="16"></line>
            <line x1="20" y1="12" x2="20" y2="3"></line>
            <line x1="1" y1="14" x2="7" y2="14"></line>
            <line x1="9" y1="8" x2="15" y2="8"></line>
            <line x1="17" y1="16" x2="23" y2="16"></line>
          </svg>
          <span>Control</span>
        </div>
        <div class="tab" onclick="switchTab(3)">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          <span>Admin</span>
        </div>
        <div class="tab" onclick="switchTab(4)">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
            <rect x="9" y="9" width="6" height="6"></rect>
            <line x1="9" y1="1" x2="9" y2="4"></line>
            <line x1="15" y1="1" x2="15" y2="4"></line>
            <line x1="9" y1="20" x2="9" y2="23"></line>
            <line x1="15" y1="20" x2="15" y2="23"></line>
            <line x1="20" y1="9" x2="23" y2="9"></line>
            <line x1="20" y1="14" x2="23" y2="14"></line>
            <line x1="1" y1="9" x2="4" y2="9"></line>
            <line x1="1" y1="14" x2="4" y2="14"></line>
          </svg>
          <span>Device</span>
        </div>
        <div class="tab" onclick="switchTab(5)">
          <svg
            class="tab-icon"
            viewBox="0 0 24 24"
            aria-hidden="true"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
          </svg>
          <span>Live</span>
        </div>

        <!-- SINGLE vertical stack of 5 buttons -->
        <div class="sidebar-controls-vertical">
          <!-- 1) Mute -->
          <div
            class="round-button mute"
            id="muteBtn"
            onclick="toggleMute()"
            title="Mute / Unmute"
          >
            <img id="muteIcon" src="icons/volume-up-4-256.png" alt="Sound" />
          </div>

          <!-- 2) Power -->
          <button id="powerButton" class="power-button state-off" title="Power">
            <span class="ring"></span>
            <span class="label" id="powerLabel">OFF</span>
          </button>

          <!-- 3) Reboot -->
          <div
            class="round-button reset"
            onclick="rebootSystem()"
            title="Reboot"
          >
            <img src="icons/refresh.png" alt="Reset" />
          </div>

          <!-- 4) Reset -->
          <div
            class="round-button reset"
            onclick="openConfirm('reset')"
            title="Reset"
          >
            <img src="icons/redo-5-16.png" alt="Reset" />
          </div>
        </div>
      </div>


      <div
        id="wiresCoolPrompt"
        class="wires-cool-prompt"
        role="status"
        aria-live="polite"
      >
        <span>Wires assumed hot. Confirm if cool.</span>
        <button
          id="wiresCoolConfirmBtn"
          type="button"
          class="settings-btn settings-btn-primary"
        >
          Confirm
        </button>
      </div>


      <!-- Dashboard Tab -->
      <div class="content active" id="dashboardTab">
        <div id="setupBanner" class="setup-banner" aria-live="polite">
          <div class="setup-banner-main">
            <div id="setupBannerTitle" class="setup-banner-title">
              Setup required
            </div>
            <div class="setup-banner-text">
              <span id="setupBannerMainText">
                Complete the setup wizard before running the device.
              </span>
              <span id="setupBannerDetail">Missing: --</span>
            </div>
          </div>
          <div class="setup-banner-actions">
            <button
              id="setupBannerOpenBtn"
              type="button"
              class="settings-btn settings-btn-primary"
            >
              Open Setup
            </button>
            <button id="setupBannerCalibBtn" type="button" class="settings-btn">
              Calibration
            </button>
          </div>
        </div>
        <div class="dashboard-panels dashboard-panels-top">
          <section
            class="user-modal-content zoom-box dashboard-card dashboard-clock"
          >
            <div class="dashboard-card-header">
              <div class="dashboard-card-heading">
                <div class="dashboard-card-title">
                  <svg
                    class="dashboard-card-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="9"></circle>
                    <path d="M12 7v5l3 3"></path>
                  </svg>
                  <span>Clock</span>
                </div>
                <div class="dashboard-card-subtitle">Local time and day</div>
              </div>
            </div>

            <div class="dashboard-clock-layout">
              <div class="dashboard-clock-face">
                <svg
                  id="dashboardClockSvg"
                  class="dashboard-clock-svg"
                  viewBox="0 0 120 120"
                  role="img"
                  aria-label="Analog clock"
                >
                  <defs>
                    <radialGradient
                      id="dashboardClockFaceGlow"
                      cx="50%"
                      cy="30%"
                      r="70%"
                    >
                      <stop
                        offset="0%"
                        stop-color="#00ffae"
                        stop-opacity="0.22"
                      />
                      <stop
                        offset="60%"
                        stop-color="#00ffae"
                        stop-opacity="0"
                      />
                      <stop
                        offset="100%"
                        stop-color="#00ffae"
                        stop-opacity="0"
                      />
                    </radialGradient>
                  </defs>

                  <circle class="clock-face" cx="60" cy="60" r="52"></circle>
                  <circle class="clock-glow" cx="60" cy="60" r="52"></circle>
                  <circle class="clock-inner" cx="60" cy="60" r="44"></circle>

                  <g class="clock-ticks" aria-hidden="true">
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(0 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(30 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(60 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(90 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(120 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(150 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(180 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(210 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(240 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(270 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(300 60 60)"
                    ></line>
                    <line
                      class="clock-tick major"
                      x1="60"
                      y1="12"
                      x2="60"
                      y2="22"
                      transform="rotate(330 60 60)"
                    ></line>
                  </g>

                  <g class="clock-hands" aria-hidden="true">
                    <line
                      id="dashboardClockHourHand"
                      class="clock-hand clock-hand-hour"
                      x1="60"
                      y1="60"
                      x2="60"
                      y2="38"
                    ></line>
                    <line
                      id="dashboardClockMinuteHand"
                      class="clock-hand clock-hand-minute"
                      x1="60"
                      y1="62"
                      x2="60"
                      y2="28"
                    ></line>
                    <line
                      id="dashboardClockSecondHand"
                      class="clock-hand clock-hand-second"
                      x1="60"
                      y1="68"
                      x2="60"
                      y2="22"
                    ></line>
                  </g>
                  <circle class="clock-pin" cx="60" cy="60" r="3.2"></circle>
                </svg>
              </div>

              <div class="dashboard-clock-meta">
                <div id="dashboardClockDay" class="dashboard-clock-day">--</div>
                <div id="dashboardClockDate" class="dashboard-clock-date">
                  --
                </div>
                <div
                  id="dashboardClockTime"
                  class="dashboard-clock-time dashboard-mono"
                >
                  --:--:--
                </div>
              </div>
            </div>
          </section>

          <section
            class="user-modal-content zoom-box dashboard-card dashboard-system"
          >
            <div class="dashboard-card-header">
              <div class="dashboard-card-heading">
                <div class="dashboard-card-title">
                  <svg
                    class="dashboard-card-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="4" y1="21" x2="4" y2="14"></line>
                    <line x1="4" y1="10" x2="4" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12" y2="3"></line>
                    <line x1="20" y1="21" x2="20" y2="16"></line>
                    <line x1="20" y1="12" x2="20" y2="3"></line>
                    <line x1="1" y1="14" x2="7" y2="14"></line>
                    <line x1="9" y1="8" x2="15" y2="8"></line>
                    <line x1="17" y1="16" x2="23" y2="16"></line>
                  </svg>
                  <span>System</span>
                </div>
                <div class="dashboard-card-subtitle">Mode, LEDs, readiness</div>
              </div>

              <svg
                class="dashboard-card-watermark"
                viewBox="0 0 120 120"
                aria-hidden="true"
              >
                <path
                  d="M14 74h26l10-24 16 44 10-26h24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  opacity="0.8"
                />
                <circle
                  cx="14"
                  cy="74"
                  r="4"
                  fill="currentColor"
                  opacity="0.65"
                />
                <circle
                  cx="110"
                  cy="68"
                  r="4"
                  fill="currentColor"
                  opacity="0.45"
                />
              </svg>
            </div>

            <div class="mode-toggle">
              <div
                class="mode-group mode-group-feedback"
                aria-label="LED feedback"
              >
                <div class="mode-group-label">LED feedback</div>
                <div class="mode-group-controls">
                  <span
                    id="ltPill"
                    class="mode-pill mode-pill-lt"
                    title="LT (LED feedback)"
                  >
                    <svg
                      class="mode-pill-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M9 18h6"></path>
                      <path d="M10 22h4"></path>
                      <path
                        d="M12 2a7 7 0 0 0-4 12c.5.5 1 1.5 1 2h6c0-.5.5-1.5 1-2a7 7 0 0 0-4-12z"
                      ></path>
                    </svg>
                    <span class="mode-pill-text">LT</span>
                  </span>
                  <label class="switch">
                    <input
                      type="checkbox"
                      id="ltToggle"
                      onchange="toggleLT()"
                    />
                    <span class="slider"></span>
                  </label>
                </div>
              </div>

              <div
                class="mode-group mode-group-status"
                aria-label="Loop status"
              >
                <div class="mode-group-label">Loop status</div>
                <div class="mode-group-controls">
                  <span class="mode-pill mode-pill-ready" title="Ready status">
                    <svg
                      class="mode-pill-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <circle cx="12" cy="12" r="9"></circle>
                      <path d="M9 12l2 2 4-4"></path>
                    </svg>
                    <span class="mode-pill-text">Ready</span>
                    <span id="readyLed" class="led" aria-hidden="true"></span>
                  </span>
                  <span class="mode-pill mode-pill-off" title="Off status">
                    <svg
                      class="mode-pill-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M12 2v10"></path>
                      <path d="M6.36 6.36a9 9 0 1 0 11.28 0"></path>
                    </svg>
                    <span class="mode-pill-text">Off</span>
                    <span id="offLed" class="led" aria-hidden="true"></span>
                  </span>
                </div>
              </div>

              <div class="dashboard-system-actions">
                <button
                  id="forceCalibrationBtn"
                  type="button"
                  class="settings-btn settings-btn-primary dashboard-action-btn"
                  onclick="forceCalibration()"
                >
                  <svg
                    class="settings-btn-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M21 12a9 9 0 1 1-2.64-6.36"></path>
                    <polyline points="21 3 21 9 15 9"></polyline>
                    <path d="M12 7v5l3 3"></path>
                  </svg>
                  <span>Force Calibration</span>
                </button>
              </div>
            </div>
          </section>
        </div>

        <div class="gauge-scroll-area">
          <div class="dashboard-panels dashboard-panels-bottom">
            <section
              class="user-modal-content zoom-box dashboard-card dashboard-electrical"
            >
              <div class="dashboard-card-header">
                <div class="dashboard-card-heading">
                  <div class="dashboard-card-title">
                    <svg
                      class="dashboard-card-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"></path>
                    </svg>
                    <span>Electrical</span>
                  </div>
                  <div class="dashboard-card-subtitle">
                    Voltage, current, capacitance
                  </div>
                </div>
              </div>

              <div class="dashboard-metrics">
                <!-- Voltage -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg voltage"
                          stroke-dasharray="92, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="voltageValue"
                      >
                        230V
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Voltage</div>
                </div>

                <!-- Current -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg current"
                          stroke-dasharray="60, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="currentValue"
                      >
                        1.2A
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Current</div>
                </div>

                <!-- Capacitance -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg voltage"
                          stroke-dasharray="0, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="capacitanceValue"
                      >
                        --mF
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Capacitance</div>
                </div>
              </div>

              <div class="dashboard-meta">
                <div class="dashboard-meta-pill">
                  <svg
                    class="dashboard-meta-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M3 12h4l2-6 4 12 2-6h6"></path>
                  </svg>
                  <span>ADC raw (/100):</span>
                  <span id="adcRawValue" class="dashboard-mono">--</span>
                </div>
              </div>
            </section>

            <section
              class="user-modal-content zoom-box dashboard-card dashboard-thermal"
            >
              <div class="dashboard-card-header">
                <div class="dashboard-card-heading">
                  <div class="dashboard-card-title">
                    <svg
                      class="dashboard-card-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path
                        d="M14 14.76V5a2 2 0 0 0-4 0v9.76a4 4 0 1 0 4 0z"
                      ></path>
                    </svg>
                    <span>Thermals</span>
                  </div>
                  <div class="dashboard-card-subtitle">
                    12 temperature channels
                  </div>
                </div>
              </div>

              <div class="dashboard-temps">
                <!-- Temp 1 -->
                <div class="gauge-card is-key">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 
                        a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="21, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 
                        a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp1Value"
                      >
                        31&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Board 01</div>
                </div>

                <!-- Temp 2 -->
                <div class="gauge-card is-key">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="17, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp2Value"
                      >
                        25&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Board 02</div>
                </div>

                <!-- Temp 3 -->
                <div class="gauge-card is-key">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="26, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp3Value"
                      >
                        39&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Heatsink</div>
                </div>

                <!-- Temp 4 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="29, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp4Value"
                      >
                        44&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 4</div>
                </div>

                <!-- Temp 5 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="19, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp5Value"
                      >
                        28&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 5</div>
                </div>

                <!-- Temp 6 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="24, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp6Value"
                      >
                        36&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 6</div>
                </div>

                <!-- Temp 7 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="14, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp7Value"
                      >
                        22&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 7</div>
                </div>

                <!-- Temp 8 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="32, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp8Value"
                      >
                        48&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 8</div>
                </div>

                <!-- Temp 9 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="18, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp9Value"
                      >
                        27&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 9</div>
                </div>

                <!-- Temp 10 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="22, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp10Value"
                      >
                        33&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 10</div>
                </div>

                <!-- Temp 11 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="27, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp11Value"
                      >
                        41&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 11</div>
                </div>

                <!-- Temp 12 -->
                <div class="gauge-card">
                  <div class="gauge">
                    <svg viewBox="0 0 36 36" class="gauge-svg">
                      <g transform="rotate(-90 18 18)">
                        <path
                          class="gauge-bg"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                        <path
                          class="gauge-fg temperature"
                          stroke-dasharray="19, 100"
                          d="M18 2.0845 a15.9155 15.9155 0 1 1 0 31.831 a15.9155 15.9155 0 1 1 0 -31.831"
                        />
                      </g>
                      <text
                        x="18"
                        y="18"
                        class="gauge-value"
                        transform="rotate(90 18 18)"
                        id="temp12Value"
                      >
                        29&deg;C
                      </text>
                    </svg>
                  </div>
                  <div class="gauge-label">Temp 12</div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>


      <!-- User Settings Tab -->
      <div class="content" id="userSettingsTab">
        <div class="content-header">
          <h2></h2>
        </div>

        <div class="user-settings-layout">
          <section
            class="user-modal-content zoom-box settings-card user-settings-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Account</span>
              </div>
              <div class="settings-card-subtitle">
                Update your password and device label.
              </div>
            </div>

            <div class="settings-form">
              <div class="settings-field">
                <label for="userCurrentPassword">Current password</label>
                <input
                  type="password"
                  id="userCurrentPassword"
                  autocomplete="current-password"
                  placeholder="Current password"
                />
              </div>

              <div class="settings-field">
                <label for="userNewPassword">New password</label>
                <input
                  type="password"
                  id="userNewPassword"
                  autocomplete="new-password"
                  placeholder="New password"
                />
              </div>

              <div class="settings-field">
                <label for="userDeviceId">Device ID</label>
                <input
                  type="text"
                  id="userDeviceId"
                  autocomplete="off"
                  placeholder="Device ID"
                />
                <div class="settings-field-hint">
                  Used as the device name/label (may require reconnect).
                </div>
              </div>
            </div>

            <div class="settings-actions">
              <button
                type="button"
                class="settings-btn settings-btn-primary"
                onclick="saveUserSettings()"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M20 6L9 17l-5-5"></path>
                </svg>
                Save
              </button>
              <button
                type="button"
                class="settings-btn"
                onclick="resetUserSettings()"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M3 12a9 9 0 1 0 3-6.7"></path>
                  <polyline points="3 3 3 9 9 9"></polyline>
                </svg>
                Reset
              </button>
            </div>
          </section>

          <section
            class="user-modal-content zoom-box settings-card user-access-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M12 1v2"></path>
                  <path d="M12 21v2"></path>
                  <path d="M4.22 4.22l1.42 1.42"></path>
                  <path d="M18.36 18.36l1.42 1.42"></path>
                  <path d="M1 12h2"></path>
                  <path d="M21 12h2"></path>
                  <path d="M4.22 19.78l1.42-1.42"></path>
                  <path d="M18.36 5.64l1.42-1.42"></path>
                  <circle cx="12" cy="12" r="4"></circle>
                </svg>
                <span>Output Access</span>
              </div>
              <div class="settings-card-subtitle">
                Select which outputs the loop/calibration is allowed to use.
              </div>
            </div>

            <div id="userAccessGrid" class="output-access-grid"></div>
          </section>
        </div>
      </div>


      <!-- Manual Control Tab -->
      <div class="content" id="manualControlTab">
        <div class="content-header">
          <h2></h2>
        </div>

        <div class="manual-control-layout">
          <section
            class="user-modal-content zoom-box settings-card manual-controls-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="4" y1="21" x2="4" y2="14"></line>
                  <line x1="4" y1="10" x2="4" y2="3"></line>
                  <line x1="12" y1="21" x2="12" y2="12"></line>
                  <line x1="12" y1="8" x2="12" y2="3"></line>
                  <line x1="20" y1="21" x2="20" y2="16"></line>
                  <line x1="20" y1="12" x2="20" y2="3"></line>
                  <line x1="1" y1="14" x2="7" y2="14"></line>
                  <line x1="9" y1="8" x2="15" y2="8"></line>
                  <line x1="17" y1="16" x2="23" y2="16"></line>
                </svg>
                <span>Manual Controls</span>
              </div>
              <div class="settings-card-subtitle">
                Adjusting these will switch to manual mode (and abort auto loop
                if running).
              </div>
            </div>

            <div class="settings-form">
              <div class="settings-field">
                <div class="settings-field-row">
                  <label for="fanSlider">Fan speed</label>
                  <span id="fanSpeedValue" class="settings-field-value"
                    >--%</span
                  >
                </div>
                <input type="range" min="0" max="100" id="fanSlider" />
              </div>

              <div class="settings-field settings-field-inline">
                <label for="relayToggle">Relay</label>
                <label class="switch">
                  <input type="checkbox" id="relayToggle" />
                  <span class="slider"></span>
                </label>
              </div>

              <div class="settings-divider"></div>

              <div class="manual-device-info">
                <div class="settings-field">
                  <div class="settings-field-row">
                    <label>Device Name/ID</label>
                    <span id="deviceInfoId" class="settings-field-value"
                      >--</span
                    >
                  </div>
                </div>

                <div class="settings-field">
                  <div class="settings-field-row">
                    <label>HW Version</label>
                    <span id="deviceInfoHw" class="settings-field-value"
                      >--</span
                    >
                  </div>
                </div>

                <div class="settings-field">
                  <div class="settings-field-row">
                    <label>SW Version</label>
                    <span id="deviceInfoSw" class="settings-field-value"
                      >--</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section
            class="user-modal-content zoom-box settings-card manual-outputs-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="3" width="8" height="8" rx="2"></rect>
                  <rect x="13" y="3" width="8" height="8" rx="2"></rect>
                  <rect x="3" y="13" width="8" height="8" rx="2"></rect>
                  <rect x="13" y="13" width="8" height="8" rx="2"></rect>
                </svg>
                <span>Manual Outputs</span>
              </div>
              <div class="settings-card-subtitle">
                Toggle outputs directly (manual mode).
              </div>
            </div>

            <div id="manualOutputs" class="manual-output-grid"></div>
          </section>
        </div>
      </div>


      <!-- Admin Settings Tab -->
      <div class="content" id="adminSettingsTab">
        <div class="content-header">
          <h2></h2>
        </div>

        <div class="admin-settings-layout">
          <section
            class="user-modal-content zoom-box settings-card setup-wizard-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="9"></circle>
                  <path d="M8 12l2.5 2.5 5-5"></path>
                </svg>
                <span>Setup Wizard</span>
              </div>
              <div class="settings-card-subtitle">
                Track required configuration and calibration before RUN.
              </div>
            </div>

            <div class="setup-wizard-body">
              <div class="setup-wizard-status">
                <div id="setupDonePill" class="setup-pill">Setup: --</div>
                <div id="setupConfigPill" class="setup-pill">Config: --</div>
                <div id="setupCalibPill" class="setup-pill">
                  Calibration: --
                </div>
                <div id="setupRunPill" class="setup-pill">Run: --</div>
              </div>

              <div class="setup-progress-grid">
                <div class="settings-field">
                  <label for="setupStageInput">Stage</label>
                  <input type="number" id="setupStageInput" min="0" step="1" />
                </div>
                <div class="settings-field">
                  <label for="setupSubstageInput">Substage</label>
                  <input
                    type="number"
                    id="setupSubstageInput"
                    min="0"
                    step="1"
                  />
                </div>
                <div class="settings-field">
                  <label for="setupWireIndexInput">Wire index</label>
                  <input
                    type="number"
                    id="setupWireIndexInput"
                    min="0"
                    max="10"
                    step="1"
                  />
                </div>
              </div>

              <div class="setup-progress-actions">
                <button
                  type="button"
                  id="setupUpdateBtn"
                  class="settings-btn settings-btn-primary"
                >
                  Update Stage
                </button>
                <button type="button" id="setupDoneBtn" class="settings-btn">
                  Mark Setup Done
                </button>
                <button
                  type="button"
                  id="setupClearDoneBtn"
                  class="settings-btn"
                >
                  Clear Setup Done
                </button>
                <button type="button" id="setupRefreshBtn" class="settings-btn">
                  Refresh
                </button>
              </div>

              <div class="setup-missing-grid">
                <div class="setup-missing-block">
                  <div class="setup-list-title">Missing config</div>
                  <ul id="setupMissingConfigList" class="setup-list"></ul>
                </div>
                <div class="setup-missing-block">
                  <div class="setup-list-title">Missing calibration</div>
                  <ul id="setupMissingCalibList" class="setup-list"></ul>
                </div>
              </div>

              <div class="setup-status-grid">
                <div class="setup-status-card">
                  <div class="setup-status-label">Floor</div>
                  <div id="setupFloorStatus" class="setup-status-value">--</div>
                </div>
                <div class="setup-status-card">
                  <div class="setup-status-label">Presence</div>
                  <div id="setupPresenceStatus" class="setup-status-value">
                    --
                  </div>
                </div>
                <div class="setup-status-card">
                  <div class="setup-status-label">Cap bank</div>
                  <div id="setupCapStatus" class="setup-status-value">--</div>
                </div>
              </div>

              <div class="setup-wire-grid" id="setupWireGrid"></div>

              <div class="setup-reset-row">
                <label class="setup-reset-option">
                  <input type="checkbox" id="setupResetClearModels" />
                  Clear models
                </label>
                <label class="setup-reset-option">
                  <input type="checkbox" id="setupResetClearWire" />
                  Clear wire params
                </label>
                <label class="setup-reset-option">
                  <input type="checkbox" id="setupResetClearFloor" />
                  Clear floor params
                </label>
                <button
                  type="button"
                  id="setupResetBtn"
                  class="settings-btn settings-btn-danger"
                >
                  Reset Setup
                </button>
              </div>
            </div>
          </section>

          <section
            class="user-modal-content zoom-box settings-card admin-credentials-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4z"></path>
                </svg>
                <span>Admin Credentials</span>
              </div>
              <div class="settings-card-subtitle">
                Current password is required to apply changes.
              </div>
            </div>

            <div class="settings-form">
              <div class="settings-field">
                <label for="adminCurrentPassword">Current password</label>
                <input
                  type="password"
                  id="adminCurrentPassword"
                  autocomplete="current-password"
                  placeholder="Current password"
                />
              </div>

              <div class="settings-field">
                <label for="adminUsername">New admin username</label>
                <input
                  type="text"
                  id="adminUsername"
                  autocomplete="username"
                  placeholder="New admin username"
                />
                <div class="settings-field-hint">
                  Leave blank to keep current.
                </div>
              </div>

              <div class="settings-field">
                <label for="adminPassword">New admin password</label>
                <input
                  type="password"
                  id="adminPassword"
                  autocomplete="new-password"
                  placeholder="New admin password"
                />
                <div class="settings-field-hint">
                  Leave blank to keep current.
                </div>
              </div>
            </div>

            <div class="settings-actions">
              <button
                type="button"
                class="settings-btn settings-btn-primary"
                onclick="saveAdminSettings('admin')"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M20 6L9 17l-5-5"></path>
                </svg>
                Save
              </button>
              <button
                type="button"
                class="settings-btn"
                onclick="resetAdminSettings('admin')"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M3 12a9 9 0 1 0 3-6.7"></path>
                  <polyline points="3 3 3 9 9 9"></polyline>
                </svg>
                Reset
              </button>
            </div>
          </section>

          <section
            class="user-modal-content zoom-box settings-card wifi-station-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                  <path d="M8.5 15.5a6 6 0 0 1 7 0"></path>
                  <path d="M12 20h.01"></path>
                </svg>
                <span>Wi-Fi Station</span>
              </div>
              <div class="settings-card-subtitle">
                Network the device should join (SSID + password).
              </div>
            </div>

            <div class="settings-form">
              <div class="settings-field">
                <label for="wifiSSID">Wi-Fi SSID</label>
                <input
                  type="text"
                  id="wifiSSID"
                  autocomplete="off"
                  placeholder="Wi-Fi SSID"
                />
                <div class="settings-field-hint">
                  Leave blank to keep current.
                </div>
              </div>

              <div class="settings-field">
                <label for="wifiPassword">Wi-Fi password</label>
                <input
                  type="password"
                  id="wifiPassword"
                  autocomplete="new-password"
                  placeholder="Wi-Fi password"
                />
                <div class="settings-field-hint">
                  Leave blank to keep current.
                </div>
              </div>
            </div>

            <div class="settings-actions">
              <button
                type="button"
                class="settings-btn settings-btn-primary"
                onclick="saveAdminSettings('wifi')"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M20 6L9 17l-5-5"></path>
                </svg>
                Save
              </button>
              <button
                type="button"
                class="settings-btn"
                onclick="resetAdminSettings('wifi')"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M3 12a9 9 0 1 0 3-6.7"></path>
                  <polyline points="3 3 3 9 9 9"></polyline>
                </svg>
                Reset
              </button>
            </div>
          </section>

          <section
            class="user-modal-content zoom-box settings-card wifi-ap-card"
          >
            <div class="settings-card-header">
              <div class="settings-card-title">
                <svg
                  class="settings-card-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M2 12.5a13 13 0 0 1 20 0"></path>
                  <path d="M6.5 16.5a7 7 0 0 1 11 0"></path>
                  <path d="M12 21h.01"></path>
                </svg>
                <span>Wi-Fi Access Point</span>
              </div>
              <div class="settings-card-subtitle">
                Hotspot name and password (AP mode).
              </div>
            </div>

            <div class="settings-form">
              <div class="settings-field">
                <label for="apSSID">AP SSID</label>
                <input
                  type="text"
                  id="apSSID"
                  autocomplete="off"
                  placeholder="AP SSID"
                />
                <div class="settings-field-hint">
                  Leave blank to keep current.
                </div>
              </div>

              <div class="settings-field">
                <label for="apPassword">AP password</label>
                <input
                  type="password"
                  id="apPassword"
                  autocomplete="new-password"
                  placeholder="AP password"
                />
                <div class="settings-field-hint">
                  Leave blank to keep current.
                </div>
              </div>
            </div>

            <div class="settings-actions">
              <button
                type="button"
                class="settings-btn settings-btn-primary"
                onclick="saveApSettings()"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M20 6L9 17l-5-5"></path>
                </svg>
                Save
              </button>
              <button
                type="button"
                class="settings-btn"
                onclick="resetApSettings()"
              >
                <svg
                  class="settings-btn-icon"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M3 12a9 9 0 1 0 3-6.7"></path>
                  <polyline points="3 3 3 9 9 9"></polyline>
                </svg>
                Reset
              </button>
            </div>
          </section>
        </div>
      </div>


      <!-- Device Settings Tab -->

      <div class="content" id="deviceSettingsTab">

        <div class="content-header">

          <h2></h2>

        </div>



        <div class="device-settings-center">

          <!-- Device Settings: ONE SINGLE BOX -->

          <div class="user-modal-content zoom-box device-settings-box">

            <div class="device-grid">

              <!-- Left column: existing device fields -->

                            <section class="device-col device-col--left">
                <h3 class="ds-col-heading ds-col-heading--device">
                  <svg
                    class="ds-col-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M12 1v2"></path>
                    <path d="M12 21v2"></path>
                    <path d="M4.22 4.22l1.42 1.42"></path>
                    <path d="M18.36 18.36l1.42 1.42"></path>
                    <path d="M1 12h2"></path>
                    <path d="M21 12h2"></path>
                    <path d="M4.22 19.78l1.42-1.42"></path>
                    <path d="M18.36 5.64l1.42-1.42"></path>
                    <circle cx="12" cy="12" r="4"></circle>
                  </svg>
                  <span>Device Settings</span>
                </h3>

                <div class="ds-group-title ds-power">
                  <svg
                    class="ds-group-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polygon
                      points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                    ></polygon>
                  </svg>
                  <span>Sampling &amp; Power</span>
                </div>

                <div class="ds-field">
                  <label for="acFrequency">Sampling Rate</label>
                  <div class="input-with-unit">
                    <input type="number" id="acFrequency" min="50" max="500" />
                    <span class="unit-label">Hz</span>
                  </div>
                </div>

                <div class="ds-field">
                  <label for="chargeResistor">Charge Resistor</label>
                  <div class="input-with-unit">
                    <input type="number" id="chargeResistor" />
                    <span class="unit-label"></span>
                  </div>
                </div>

                <div class="ds-field">
                  <label for="currLimit">Current Trip Limit</label>
                  <div class="input-with-unit">
                    <input type="number" id="currLimit" step="0.1" />
                    <span class="unit-label">A</span>
                  </div>
                </div>

                <div class="ds-field">
                  <label for="currentSource">Current Source</label>
                  <select id="currentSource">
                    <option value="1">ACS Sensor</option>
                    <option value="0">CSP Discharge Estimate</option>
                  </select>
                </div>

                <div class="ds-group-title ds-thermal-safety">
                  <svg
                    class="ds-group-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"
                    ></path>
                    <path d="M12 8v5"></path>
                    <path d="M12 16h.01"></path>
                  </svg>
                  <span>Thermal Safety</span>
                </div>

                <div class="ds-field">
                  <label for="tempWarnC">Temp Warning</label>
                  <div class="input-with-unit">
                    <input type="number" id="tempWarnC" step="0.1" />
                    <span class="unit-label">&deg;C</span>
                  </div>
                </div>

                <div class="ds-field">
                  <label for="tempTripC">Temp Trip (Shutdown)</label>
                  <div class="input-with-unit">
                    <input type="number" id="tempTripC" step="0.1" />
                    <span class="unit-label">&deg;C</span>
                  </div>
                </div>

                <div class="ds-group-title ds-thermal-model">
                  <svg
                    class="ds-group-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect
                      x="4"
                      y="4"
                      width="16"
                      height="16"
                      rx="2"
                      ry="2"
                    ></rect>
                    <rect x="9" y="9" width="6" height="6"></rect>
                    <path d="M9 1v3"></path>
                    <path d="M15 1v3"></path>
                    <path d="M9 20v3"></path>
                    <path d="M15 20v3"></path>
                    <path d="M20 9h3"></path>
                    <path d="M20 15h3"></path>
                    <path d="M1 9h3"></path>
                    <path d="M1 15h3"></path>
                  </svg>
                  <span>Thermal Model</span>
                </div>

                <div class="ds-field">
                  <label for="modelParamTarget">Model Target</label>
                  <select id="modelParamTarget">
                    <option value="wire1">Wire 1</option>
                    <option value="wire2">Wire 2</option>
                    <option value="wire3">Wire 3</option>
                    <option value="wire4">Wire 4</option>
                    <option value="wire5">Wire 5</option>
                    <option value="wire6">Wire 6</option>
                    <option value="wire7">Wire 7</option>
                    <option value="wire8">Wire 8</option>
                    <option value="wire9">Wire 9</option>
                    <option value="wire10">Wire 10</option>
                    <option value="floor">Floor</option>
                  </select>
                </div>

                <div class="ds-field">
                  <label for="modelTau">Tau</label>
                  <div class="input-with-unit">
                    <input type="number" id="modelTau" step="0.01" />
                    <span class="unit-label">s</span>
                  </div>
                </div>

                <div class="ds-field">
                  <label for="modelK">K Loss</label>
                  <div class="input-with-unit">
                    <input type="number" id="modelK" step="0.001" />
                    <span class="unit-label">W/K</span>
                  </div>
                </div>

                <div class="ds-field">
                  <label for="modelC">Thermal C</label>
                  <div class="input-with-unit">
                    <input type="number" id="modelC" step="0.01" />
                    <span class="unit-label">J/K</span>
                  </div>
                </div>

                <div id="ntcParamsCard">
                  <div class="ds-group-title ds-ntc">
                    <svg
                      class="ds-group-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M14 14.76V3.5a2 2 0 0 0-4 0v11.26"></path>
                      <circle cx="12" cy="17" r="4"></circle>
                    </svg>
                    <span>NTC Parameters</span>
                  </div>

                  <div class="ds-field">
                    <label for="ntcBeta">Beta</label>
                    <input type="number" id="ntcBeta" step="1" min="1" />
                  </div>

                  <div class="ds-field">
                    <label for="ntcT0C">T0</label>
                    <div class="input-with-unit">
                      <input type="number" id="ntcT0C" step="0.1" />
                      <span class="unit-label">C</span>
                    </div>
                  </div>

                  <div class="ds-field">
                    <label for="ntcR0">R0 / R25</label>
                    <div class="input-with-unit">
                      <input type="number" id="ntcR0" step="1" />
                      <span class="unit-label">&Omega;</span>
                    </div>
                  </div>

                  <div class="ds-field">
                    <label for="ntcFixedRes">Fixed Pull-up Resistor</label>
                    <div class="input-with-unit">
                      <input type="number" id="ntcFixedRes" step="1" />
                      <span class="unit-label">&Omega;</span>
                    </div>
                  </div>
                </div>

                <div class="ds-group-title ds-presence">
                  <svg
                    class="ds-group-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="9"></circle>
                    <path d="M12 7v5"></path>
                    <path d="M12 16h.01"></path>
                  </svg>
                  <span>Presence</span>
                </div>

                <div class="ds-field">
                  <label for="presenceMinDropV"
                    >Presence Min Voltage Drop</label
                  >
                  <div class="input-with-unit">
                    <input
                      type="number"
                      id="presenceMinDropV"
                      step="0.01"
                      min="0"
                    />
                    <span class="unit-label">V</span>
                  </div>
                </div>
              </section>




              <!-- Right column: Nichrome -->

                            <section class="device-col device-col--right">
                <h3 class="ds-col-heading ds-col-heading--nichrome">
                  <svg
                    class="ds-col-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M12 2c0 4-2 6-2 8a3 3 0 0 0 6 0c0-2-2-4-2-8"
                    ></path>
                    <path
                      d="M8.5 14.5C7.3 15.7 7 17 7 18a5 5 0 0 0 10 0c0-1-.3-2.3-1.5-3.5"
                    ></path>
                  </svg>
                  <span>Nichrome Calibration</span>
                </h3>

                <div
                  class="device-subtabs"
                  role="tablist"
                  aria-label="Nichrome settings tabs"
                >
                  <button
                    type="button"
                    class="device-subtab-btn is-active"
                    data-device-subtab="nichrome"
                    role="tab"
                    aria-selected="true"
                  >
                    <svg
                      class="device-subtab-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <rect x="3" y="3" width="7" height="7"></rect>
                      <rect x="14" y="3" width="7" height="7"></rect>
                      <rect x="3" y="14" width="7" height="7"></rect>
                      <rect x="14" y="14" width="7" height="7"></rect>
                    </svg>
                    <span>Nichrome</span>
                  </button>
                  <button
                    type="button"
                    class="device-subtab-btn"
                    data-device-subtab="energy"
                    role="tab"
                    aria-selected="false"
                  >
                    <svg
                      class="device-subtab-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polyline
                        points="22 12 18 12 15 21 9 3 6 12 2 12"
                      ></polyline>
                    </svg>
                    <span>Energy Control</span>
                  </button>
                </div>

                <div class="device-subtab-panels">
                  <div
                    class="device-subtab-panel is-active"
                    data-device-subtab-panel="nichrome"
                    role="tabpanel"
                  >
                    <div class="ds-group-title ds-floor">
                      <svg
                        class="ds-group-icon"
                        viewBox="0 0 24 24"
                        aria-hidden="true"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <line x1="4" y1="6" x2="20" y2="6"></line>
                        <circle cx="9" cy="6" r="2"></circle>
                        <line x1="4" y1="12" x2="20" y2="12"></line>
                        <circle cx="15" cy="12" r="2"></circle>
                        <line x1="4" y1="18" x2="20" y2="18"></line>
                        <circle cx="11" cy="18" r="2"></circle>
                      </svg>
                      <span>Floor Settings</span>
                    </div>
                    <div class="nichrome-meta">
                      <div class="ds-field">
                        <label for="floorThicknessMm"
                          >Floor Thickness (20-50 mm)</label
                        >
                        <div class="input-with-unit">
                          <input
                            type="number"
                            id="floorThicknessMm"
                            step="0.1"
                            min="20"
                            max="50"
                          />
                          <span class="unit-label">mm</span>
                        </div>
                      </div>
                      <div class="ds-field">
                        <label for="nichromeFinalTempC"
                          >Nichrome Final Temp</label
                        >
                        <div class="input-with-unit">
                          <input
                            type="number"
                            id="nichromeFinalTempC"
                            step="0.1"
                          />
                          <span class="unit-label">C</span>
                        </div>
                      </div>
                      <div class="ds-field">
                        <label for="ntcGateIndex">NTC Linked Channel</label>
                        <div class="input-with-unit">
                          <input
                            type="number"
                            id="ntcGateIndex"
                            min="1"
                            max="10"
                            step="1"
                          />
                          <span class="unit-label">CH</span>
                        </div>
                      </div>
                      <div class="ds-field">
                        <label for="floorMaterial">Floor Material</label>
                        <select id="floorMaterial">
                          <option value="wood">Wood</option>
                          <option value="epoxy">Epoxy</option>
                          <option value="concrete">Concrete</option>
                          <option value="slate">Slate</option>
                          <option value="marble">Marble</option>
                          <option value="granite">Granite</option>
                        </select>
                      </div>
                      <div class="ds-field">
                        <label for="floorMaxC">Max Floor Temp (<= 35 C)</label>
                        <div class="input-with-unit">
                          <input
                            type="number"
                            id="floorMaxC"
                            step="0.1"
                            max="35"
                          />
                          <span class="unit-label">C</span>
                        </div>
                      </div>
                      <div class="ds-field">
                        <label for="floorSwitchMarginC"
                          >Floor Switch Margin</label
                        >
                        <div class="input-with-unit">
                          <input
                            type="number"
                            id="floorSwitchMarginC"
                            step="0.1"
                          />
                          <span class="unit-label">C</span>
                        </div>
                      </div>
                    </div>
                    <div class="ds-group-title ds-nichrome">
                      <svg
                        class="ds-group-icon"
                        viewBox="0 0 24 24"
                        aria-hidden="true"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                      </svg>
                      <span>Nichrome Calibration</span>
                    </div>
                    <div class="nichrome-grid">
                      <!-- New: global /m -->
                      <div class="field">
                        <label for="wireOhmPerM">Wire Resistivity (/m)</label>
                        <input
                          id="wireOhmPerM"
                          type="number"
                          step="0.01"
                          inputmode="decimal"
                        />
                      </div>
                      <!-- R01..R10 -->
                      <div class="field">
                        <label for="r01ohm">R01 ()</label>
                        <input
                          id="r01ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r02ohm">R02 ()</label>
                        <input
                          id="r02ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r03ohm">R03 ()</label>
                        <input
                          id="r03ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r04ohm">R04 ()</label>
                        <input
                          id="r04ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r05ohm">R05 ()</label>
                        <input
                          id="r05ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r06ohm">R06 ()</label>
                        <input
                          id="r06ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r07ohm">R07 ()</label>
                        <input
                          id="r07ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r08ohm">R08 ()</label>
                        <input
                          id="r08ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r09ohm">R09 ()</label>
                        <input
                          id="r09ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                      <div class="field">
                        <label for="r10ohm">R10 ()</label>
                        <input
                          id="r10ohm"
                          type="number"
                          step="0.1"
                          inputmode="decimal"
                        />
                      </div>
                    </div>
                  </div>

                  <div
                    class="device-subtab-panel"
                    data-device-subtab-panel="energy"
                    role="tabpanel"
                    hidden
                  >
                    <div class="energy-control-grid" id="energyControlGrid">
                      <div class="ds-group-title ds-loop-timing">
                        <svg
                          class="ds-group-icon"
                          viewBox="0 0 24 24"
                          aria-hidden="true"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <polyline
                            points="22 12 18 12 15 21 9 3 6 12 2 12"
                          ></polyline>
                        </svg>
                        <span>Energy Control</span>
                      </div>

                      <div class="ds-field">
                        <label for="wireGauge">Wire Gauge (AWG)</label>
                        <input
                          id="wireGauge"
                          type="number"
                          step="1"
                          min="1"
                          max="40"
                          inputmode="numeric"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </section>


            </div>



            <div class="device-settings-actions settings-actions">

              <button

                type="button"

                class="settings-btn settings-btn-primary"

                onclick="saveDeviceAndNichrome()"

                title="Save device + nichrome settings"

              >

                <svg

                  class="settings-btn-icon"

                  viewBox="0 0 24 24"

                  aria-hidden="true"

                  fill="none"

                  stroke="currentColor"

                  stroke-width="2"

                  stroke-linecap="round"

                  stroke-linejoin="round"

                >

                  <path d="M20 6L9 17l-5-5"></path>

                </svg>

                Save

              </button>

              <button

                type="button"

                class="settings-btn"

                onclick="resetDeviceAndNichrome()"

                title="Reset to last loaded values"

              >

                <svg

                  class="settings-btn-icon"

                  viewBox="0 0 24 24"

                  aria-hidden="true"

                  fill="none"

                  stroke="currentColor"

                  stroke-width="2"

                  stroke-linecap="round"

                  stroke-linejoin="round"

                >

                  <path d="M3 12a9 9 0 1 0 3-6.7"></path>

                  <polyline points="3 3 3 9 9 9"></polyline>

                </svg>

                Reset

              </button>

            </div>

          </div>

        </div>

      </div>




      <!-- Live Tab -->

      <!-- Live Tab -->

      <div class="content" id="liveTab">

        <div class="content-header">

          <h2></h2>

        </div>



        <div class="live-wrap">

                    <!-- Legend -->
          <div class="live-legend">
            <span class="chip on-chip">
              <span class="dot-sample on"></span>
              ON (energized)
            </span>
            <span class="chip off-chip">
              <span class="dot-sample off"></span>
              OFF (connected)
            </span>
            <span class="chip cyan-chip">
              <span class="dot-sample cyan"></span>
              No wire / Not connected
            </span>
          </div>



                    <!-- Centralized radial stage -->
          <div class="live-stage">
            <!-- SVG: traces + dots + temp circles -->
            <svg
              class="live-overlay"
              viewBox="0 0 100 100"
              preserveAspectRatio="xMidYMid meet"
            ></svg>

            <!-- Center core: current session data -->
            <div class="live-core">
              <svg
                class="live-core-sigil"
                viewBox="0 0 120 120"
                aria-hidden="true"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="60" cy="60" r="42" opacity="0.35"></circle>
                <circle cx="60" cy="60" r="30" opacity="0.18"></circle>
                <path d="M18 60h18l7-18 12 36 7-18h40" opacity="0.55"></path>
                <path d="M34 36h14M72 84h14" opacity="0.22"></path>
                <circle cx="36" cy="36" r="2.2" opacity="0.35"></circle>
                <circle cx="84" cy="84" r="2.2" opacity="0.35"></circle>
              </svg>
              <div class="live-core-header">
                <div class="live-core-label">
                  <svg
                    class="live-core-label-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 20V4"></path>
                    <path d="M4 20H20"></path>
                    <polyline points="5 14 9 10 13 13 20 7"></polyline>
                  </svg>
                  <span>Current Session</span>
                </div>
                <div class="live-core-indicator" title="Live monitor">
                  <span class="live-core-dot" aria-hidden="true"></span>
                  <span class="live-core-indicator-text">LIVE</span>
                </div>
              </div>

              <div
                id="sessionStatus"
                class="session-status session-status-idle"
              >
                No active session
              </div>

              <div class="live-core-metrics">
                <div class="metric">
                  <div class="metric-label">
                    <svg
                      class="metric-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polygon
                        points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                      ></polygon>
                    </svg>
                    <span>Energy</span>
                  </div>
                  <div id="sessionEnergy" class="metric-value">-- Wh</div>
                </div>
                <div class="metric">
                  <div class="metric-label">
                    <svg
                      class="metric-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <circle cx="12" cy="12" r="9"></circle>
                      <polyline points="12 7 12 12 15 15"></polyline>
                    </svg>
                    <span>Duration</span>
                  </div>
                  <div id="sessionDuration" class="metric-value">-- s</div>
                </div>
                <div class="metric">
                  <div class="metric-label">
                    <svg
                      class="metric-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <line x1="18" y1="20" x2="18" y2="10"></line>
                      <line x1="12" y1="20" x2="12" y2="4"></line>
                      <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    <span>Peak Power</span>
                  </div>
                  <div id="sessionPeakPower" class="metric-value">-- W</div>
                </div>
                <div class="metric">
                  <div class="metric-label">
                    <svg
                      class="metric-icon"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polyline
                        points="22 12 18 12 15 21 9 3 6 12 2 12"
                      ></polyline>
                    </svg>
                    <span>Peak Current</span>
                  </div>
                  <div id="sessionPeakCurrent" class="metric-value">-- A</div>
                </div>
              </div>

              <div class="live-core-actions">
                <button
                  id="sessionHistoryBtn"
                  type="button"
                  class="session-history-btn"
                >
                  <svg
                    class="live-core-btn-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="4" cy="6" r="1"></circle>
                    <circle cx="4" cy="12" r="1"></circle>
                    <circle cx="4" cy="18" r="1"></circle>
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                  </svg>
                  <span>History</span>
                </button>
                <button
                  id="calibrationBtn"
                  type="button"
                  class="session-history-btn session-calib-btn"
                >
                  <svg
                    class="live-core-btn-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <circle cx="9" cy="6" r="2"></circle>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <circle cx="15" cy="12" r="2"></circle>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                    <circle cx="11" cy="18" r="2"></circle>
                  </svg>
                  <span>Calibration</span>
                </button>
                <button
                  id="liveControlBtn"
                  type="button"
                  class="session-history-btn session-live-btn"
                >
                  <svg
                    class="live-core-btn-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 20V4"></path>
                    <path d="M4 20H20"></path>
                    <polyline points="5 14 9 10 13 13 20 7"></polyline>
                  </svg>
                  <span>Live Control</span>
                </button>
                <button
                  id="errorBtn"
                  type="button"
                  class="session-history-btn session-error-btn"
                >
                  <svg
                    class="live-core-btn-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                    ></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                  <span>Error</span>
                </button>
                <button
                  id="logBtn"
                  type="button"
                  class="session-history-btn session-log-btn"
                >
                  <svg
                    class="live-core-btn-icon"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                    ></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <line x1="10" y1="9" x2="8" y2="9"></line>
                  </svg>
                  <span>Log</span>
                </button>
              </div>
            </div>
          </div>



                    <!-- Session History modal (unchanged skeleton, just kept below) -->
          <div id="sessionHistoryModal" class="session-history-modal">
            <div
              class="session-history-backdrop"
              onclick="closeSessionHistory()"
            ></div>
            <div class="session-history-content">
              <div class="session-history-header">
                <h3>Session History</h3>
                <button
                  type="button"
                  class="session-history-close"
                  onclick="closeSessionHistory()"
                >
                  
                </button>
              </div>
              <div class="session-history-body">
                <p class="session-history-placeholder">
                  No history loaded yet. Backend will populate this table.
                </p>
                <table class="session-history-table">
                  <thead>
                    <tr>
                      <th>Time</th>
                      <th>Duration</th>
                      <th>Energy (Wh)</th>
                      <th>Peak P (W)</th>
                      <th>Peak I (A)</th>
                    </tr>
                  </thead>
                  <tbody id="sessionHistoryTableBody">
                    <!-- rows from backend -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>




                    <!-- Calibration modal -->
          <div id="calibrationModal" class="calibration-modal">
            <div
              class="calibration-backdrop"
              onclick="closeCalibrationModal()"
            ></div>
            <div class="calibration-content">
              <div class="calibration-header">
                <h3>Calibration</h3>
                <div class="calibration-header-actions">
                  <button
                    id="calibrationInfoBtn"
                    type="button"
                    class="calib-btn"
                  >
                    ?
                  </button>
                  <button
                    type="button"
                    class="calibration-close"
                    onclick="closeCalibrationModal()"
                  >
                    x
                  </button>
                </div>
              </div>
              <div class="calibration-body">
                <div
                  id="calibrationInfoPopover"
                  class="calibration-info-popover"
                  aria-hidden="true"
                >
                  <div class="calibration-info-header">
                    <div class="calibration-info-title">Calibration help</div>
                    <button
                      id="calibrationInfoCloseBtn"
                      type="button"
                      class="calibration-info-close"
                    >
                      x
                    </button>
                  </div>
                  <div class="calibration-info-content">
                    <div class="calibration-info-grid">
                      <div class="calibration-info-card">
                        <div class="calibration-info-icon">1</div>
                        <div class="calibration-info-card-title">
                          Temp model calibration
                        </div>
                        <div class="calibration-info-card-text">
                          Records temperature and time while the energy-based
                          loop heats and cools the wire. Use the resulting curve
                          to fit tau/k/C so the model matches real measurements.
                        </div>
                      </div>
                      <div class="calibration-info-card">
                        <div class="calibration-info-icon">2</div>
                        <div class="calibration-info-card-title">Wire test</div>
                        <div class="calibration-info-card-text">
                          Runs the energy-based sequential loop across all
                          allowed outputs to reach and hold the target
                          temperature. This is a live test and does not save
                          history.
                        </div>
                      </div>
                      <div class="calibration-info-card">
                        <div class="calibration-info-icon">3</div>
                        <div class="calibration-info-card-title">
                          Floor model calibration
                        </div>
                        <div class="calibration-info-card-text">
                          Logs floor response using NTC (floor) and heatsink
                          (ambient) to estimate floor tau/k/C.
                        </div>
                      </div>
                    </div>

                    <div class="calibration-info-actions">
                      <div class="calibration-info-actions-title">Buttons</div>
                      <ul>
                        <li>
                          <strong>Temp Model Calibration:</strong> Start/stop
                          the model capture while the energy loop runs.
                        </li>
                        <li>
                          <strong>Start/Stop Wire Test:</strong> Run the energy
                          loop across all allowed outputs to hold the target.
                        </li>
                        <li>
                          <strong>Floor Model Calibration:</strong> Run floor
                          capture to save the floor model parameters.
                        </li>
                        <li>
                          <strong>Presence Probe:</strong> Detect connected
                          wires and update presence calibration.
                        </li>
                        <li>
                          <strong>Load History / Resume Live:</strong> View
                          saved buffer or live feed.
                        </li>
                        <li>
                          <strong>Clear Data:</strong> Clears the buffer and
                          removes the saved file.
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div class="calibration-hero">
                  <h4>Simple steps</h4>
                  <div class="cal-steps">
                    <div class="cal-step">
                      <span class="dot">1</span>
                      <p>
                        Model capture<br />
                        <span class="hint"
                          >Start Temp Model Calibration to log heat/cool with
                          energy packets.</span
                        >
                      </p>
                    </div>
                    <div class="cal-step">
                      <span class="dot">2</span>
                      <p>
                        Wire test<br />
                        <span class="hint"
                          >Hold a target temp and verify the energy loop (no
                          logging).</span
                        >
                      </p>
                    </div>
                    <div class="cal-step">
                      <span class="dot">3</span>
                      <p>
                        Floor model<br />
                        <span class="hint"
                          >Capture floor response with NTC + heatsink.</span
                        >
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Error details modal -->
                <div id="errorModal" class="error-modal">
                  <div class="error-backdrop" onclick="closeErrorModal()"></div>
                  <div class="error-content">
                    <div class="error-header">
                      <h3 id="eventModalTitle">Last Stop / Error</h3>
                      <button
                        type="button"
                        class="error-close"
                        onclick="closeErrorModal()"
                      >
                        x
                      </button>
                    </div>
                    <div class="error-body">
                      <div class="error-row" id="errorStateRow">
                        <span class="error-label">Current state</span>
                        <span id="errorStateText">--</span>
                      </div>
                      <div class="error-section" id="lastErrorSection">
                        <div class="error-title">Last error</div>
                        <div class="error-row">
                          <span class="error-label">Reason</span>
                          <span id="errorReasonText">--</span>
                        </div>
                        <div class="error-row">
                          <span class="error-label">Time</span>
                          <span id="errorTimeText">--</span>
                        </div>
                      </div>
                      <div class="error-section" id="lastStopSection">
                        <div class="error-title">Last stop</div>
                        <div class="error-row">
                          <span class="error-label">Reason</span>
                          <span id="stopReasonText">--</span>
                        </div>
                        <div class="error-row">
                          <span class="error-label">Time</span>
                          <span id="stopTimeText">--</span>
                        </div>
                      </div>
                      <div class="error-section" id="warningHistorySection">
                        <div class="error-title">Warnings (last 10)</div>
                        <div id="warningList" class="error-list">
                          <div class="error-empty">No warnings logged yet.</div>
                        </div>
                      </div>
                      <div class="error-section" id="errorHistorySection">
                        <div class="error-title">Errors (last 10)</div>
                        <div id="errorList" class="error-list">
                          <div class="error-empty">No errors logged yet.</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Log modal -->
                <div id="logModal" class="log-modal">
                  <div class="log-backdrop" onclick="closeLogModal()"></div>
                  <div class="log-content">
                    <div class="log-header">
                      <h3>Device Log</h3>
                      <button
                        type="button"
                        class="log-close"
                        onclick="closeLogModal()"
                      >
                        x
                      </button>
                    </div>
                    <div class="log-actions">
                      <button id="logRefreshBtn" type="button" class="log-btn">
                        Refresh
                      </button>
                      <button
                        id="logClearBtn"
                        type="button"
                        class="log-btn log-clear"
                      >
                        Clear
                      </button>
                    </div>
                    <pre id="logContent" class="log-body">Loading...</pre>
                  </div>
                </div>

                <div class="calib-actionbar">
                  <div class="calib-action-group">
                    <button
                      id="startModelCalibBtn"
                      type="button"
                      class="calib-btn"
                    >
                      Temp Model Calibration
                    </button>
                    <button
                      id="stopCalibBtn"
                      type="button"
                      class="calib-btn calib-stop"
                    >
                      Stop &amp; Save
                    </button>
                  </div>
                  <div class="calib-action-group">
                    <button
                      id="calibHistoryBtn"
                      type="button"
                      class="calib-secondary"
                    >
                      Load History
                    </button>
                    <button
                      id="calibClearBtn"
                      type="button"
                      class="calib-secondary calib-danger"
                    >
                      Clear Data
                    </button>
                  </div>
                </div>

                <div class="calibration-status">
                  <div class="calib-stat">
                    Status: <span id="calibStatusText">Idle</span>
                  </div>
                  <div class="calib-stat">
                    Mode: <span id="calibModeText">--</span>
                  </div>
                  <div class="calib-stat">
                    Samples: <span id="calibCountText">0</span>
                  </div>
                  <div class="calib-stat">
                    Interval: <span id="calibIntervalText">--</span>
                  </div>
                  <div class="calib-stat">
                    Temp: <span id="calibTempText">--</span>
                  </div>
                  <div class="calib-stat">
                    Wire: <span id="calibWireText">--</span>
                  </div>
                  <div class="calib-stat">
                    Target: <span id="calibTargetText">--</span>
                  </div>
                  <div class="calib-stat">
                    Elapsed: <span id="calibElapsedText">--</span>
                  </div>
                </div>

                <div class="calib-history-picker">
                  <label for="calibHistorySelect">Saved history</label>
                  <select id="calibHistorySelect"></select>
                  <button
                    id="calibHistoryLoadBtn"
                    type="button"
                    class="calib-secondary"
                  >
                    Load Saved
                  </button>
                  <button
                    id="calibHistoryRefreshBtn"
                    type="button"
                    class="calib-secondary"
                  >
                    Refresh List
                  </button>
                </div>

                <div class="calibration-wire-test">
                  <div class="ds-field">
                    <label for="wireTestTargetC">Target Temp</label>
                    <div class="input-with-unit">
                      <input type="number" id="wireTestTargetC" step="0.1" />
                      <span class="unit-label">C</span>
                    </div>
                  </div>
                  <div class="ds-field">
                    <button
                      id="wireTestStartBtn"
                      type="button"
                      class="calib-btn"
                    >
                      Start Wire Test
                    </button>
                  </div>
                  <div class="ds-field">
                    <button
                      id="wireTestStopBtn"
                      type="button"
                      class="calib-btn calib-stop"
                    >
                      Stop Wire Test
                    </button>
                  </div>
                  <div class="status-line wide">
                    Energy Loop: <span id="wireTestState">Idle</span> | Mode:
                    <span id="wireTestMode">--</span> | Purpose:
                    <span id="wireTestPurpose">--</span> | Active:
                    <span id="wireTestActiveWire">--</span> | NTC:
                    <span id="wireTestNtcTemp">--</span> | Model:
                    <span id="wireTestModelTemp">--</span> | Packet:
                    <span id="wireTestPacket">--</span> | Frame:
                    <span id="wireTestFrame">--</span>
                  </div>
                </div>

                <div class="calibration-section">
                  <div class="calibration-section-header">
                    <h4>Floor Model Calibration</h4>
                    <span class="calibration-section-note"
                      >Use NTC as floor sensor and heatsink as ambient.</span
                    >
                  </div>
                  <div class="calibration-wire-test floor-calibration-grid">
                    <div class="ds-field">
                      <label for="floorCalTargetC">Target Temp</label>
                      <div class="input-with-unit">
                        <input type="number" id="floorCalTargetC" step="0.1" />
                        <span class="unit-label">C</span>
                      </div>
                    </div>
                    <div class="ds-field">
                      <label for="floorCalDutyPct">Duty</label>
                      <div class="input-with-unit">
                        <input
                          type="number"
                          id="floorCalDutyPct"
                          step="1"
                          min="5"
                          max="100"
                        />
                        <span class="unit-label">%</span>
                      </div>
                    </div>
                    <div class="ds-field">
                      <label for="floorCalAmbientMin">Ambient</label>
                      <div class="input-with-unit">
                        <input
                          type="number"
                          id="floorCalAmbientMin"
                          step="1"
                          min="1"
                        />
                        <span class="unit-label">min</span>
                      </div>
                    </div>
                    <div class="ds-field">
                      <label for="floorCalHeatMin">Heat</label>
                      <div class="input-with-unit">
                        <input
                          type="number"
                          id="floorCalHeatMin"
                          step="1"
                          min="1"
                        />
                        <span class="unit-label">min</span>
                      </div>
                    </div>
                    <div class="ds-field">
                      <label for="floorCalCoolMin">Cool</label>
                      <div class="input-with-unit">
                        <input
                          type="number"
                          id="floorCalCoolMin"
                          step="1"
                          min="0"
                        />
                        <span class="unit-label">min</span>
                      </div>
                    </div>
                    <div class="ds-field">
                      <label for="floorCalIntervalMs">Interval</label>
                      <div class="input-with-unit">
                        <input
                          type="number"
                          id="floorCalIntervalMs"
                          step="50"
                          min="50"
                          max="5000"
                        />
                        <span class="unit-label">ms</span>
                      </div>
                    </div>
                    <div class="ds-field">
                      <label for="floorCalWireIndex">Wire index</label>
                      <input
                        type="number"
                        id="floorCalWireIndex"
                        step="1"
                        min="1"
                        max="10"
                      />
                    </div>
                    <div class="ds-field">
                      <button
                        id="startFloorCalibBtn"
                        type="button"
                        class="calib-btn"
                      >
                        Start Floor Cal
                      </button>
                    </div>
                  </div>
                  <div class="calibration-status floor-cal-status">
                    <div class="calib-stat">
                      Stage: <span id="floorCalStageText">--</span>
                    </div>
                    <div class="calib-stat">
                      Running: <span id="floorCalRunningText">--</span>
                    </div>
                    <div class="calib-stat">
                      Calibrated: <span id="floorCalDoneText">--</span>
                    </div>
                    <div class="calib-stat">
                      Tau: <span id="floorCalTauText">--</span>
                    </div>
                    <div class="calib-stat">
                      K: <span id="floorCalKText">--</span>
                    </div>
                    <div class="calib-stat">
                      C: <span id="floorCalCText">--</span>
                    </div>
                  </div>
                </div>

                <div id="presenceProbeSection" class="calibration-section">
                  <div class="calibration-section-header">
                    <h4>Presence Probe</h4>
                    <span class="calibration-section-note"
                      >Detect connected wires while idle.</span
                    >
                  </div>
                  <div class="calibration-wire-test presence-probe-row">
                    <div class="ds-field">
                      <button
                        id="presenceProbeBtn"
                        type="button"
                        class="calib-secondary"
                      >
                        Run Presence Probe
                      </button>
                    </div>
                    <div class="ds-field status-line">
                      Status: <span id="presenceProbeStatusText">--</span>
                    </div>
                  </div>
                  <div id="presenceProbeGrid" class="presence-probe-grid"></div>
                </div>

                <div class="calibration-chart">
                  <div class="calib-chart-top">
                    <div>
                      <div class="calib-chart-title">Temperature vs Time</div>
                      <div class="calib-chart-sub">
                        Drag the chart to pan horizontally. Y axis stays
                        visible.
                      </div>
                    </div>

                    <div class="calib-chart-controls">
                      <button
                        id="calibLatestBtn"
                        type="button"
                        class="calib-secondary"
                      >
                        Most recent
                      </button>
                      <button
                        id="calibPauseBtn"
                        type="button"
                        class="calib-secondary"
                      >
                        Pause
                      </button>
                    </div>

                    <div class="calib-chart-stats">
                      <div class="calib-pill">
                        Temp: <b id="calibNowTempPill">--</b>&nbsp;C
                      </div>
                      <div class="calib-pill">
                        Time:
                        <b id="calibNowTimePill" class="calib-mono">--:--</b>
                      </div>
                      <div class="calib-pill">Max: <b>150</b>&nbsp;C</div>
                    </div>
                  </div>

                  <div class="calib-chart-shell">
                    <div class="calib-axis-col">
                      <svg id="calibYAxis" role="img" aria-label="Y axis"></svg>
                    </div>
                    <div
                      id="calibScrollWrap"
                      class="calib-scroll-wrap"
                      title="Drag to pan horizontally"
                    >
                      <svg
                        id="calibPlot"
                        role="img"
                        aria-label="Temperature chart"
                      ></svg>
                    </div>
                  </div>
                </div>

                <!-- Buttons moved to the action bar for a cleaner layout -->
              </div>
            </div>
          </div>


        </div>

      </div>




      <!-- Live control view modal -->
      <div id="liveControlModal" class="live-control-modal">
        <div
          class="live-control-backdrop"
          onclick="closeLiveControlModal()"
        ></div>
        <div class="live-control-content">
          <div class="live-control-header">
            <h3>Live Control View</h3>
            <button
              type="button"
              class="live-control-close"
              onclick="closeLiveControlModal()"
            >
              x
            </button>
          </div>
          <div class="live-control-body">
            <div class="calibration-chart live-control-chart">
              <div class="calib-chart-top">
                <div>
                  <div class="calib-chart-title">Temperature vs Time</div>
                  <div class="calib-chart-sub">
                    Live trace of allowed outputs with the setpoint line.
                  </div>
                </div>
                <div class="calib-chart-controls">
                  <button
                    id="liveControlLatestBtn"
                    type="button"
                    class="calib-secondary"
                  >
                    Latest
                  </button>
                  <button
                    id="liveControlPauseBtn"
                    type="button"
                    class="calib-secondary"
                  >
                    Pause
                  </button>
                  <button
                    id="liveControlClearBtn"
                    type="button"
                    class="calib-secondary calib-danger"
                  >
                    Clear
                  </button>
                </div>
                <div class="calib-chart-stats">
                  <div class="calib-pill">
                    Setpoint: <b id="liveControlSetpointPill">--</b>&nbsp;C
                  </div>
                  <div class="calib-pill">
                    Mode: <b id="liveControlModePill">--</b>
                  </div>
                  <div class="calib-pill">
                    Time:
                    <b id="liveControlNowTimePill" class="calib-mono">--:--</b>
                  </div>
                </div>
              </div>

              <div id="liveControlLegend" class="live-control-legend"></div>

              <div class="calib-chart-shell">
                <div class="calib-axis-col">
                  <svg
                    id="liveControlYAxis"
                    role="img"
                    aria-label="Y axis"
                  ></svg>
                </div>
                <div id="liveControlScrollWrap" class="calib-scroll-wrap">
                  <svg
                    id="liveControlPlot"
                    role="img"
                    aria-label="Live control chart"
                  ></svg>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Footer -->
      <div class="footer">&copy; 2025 Power Distribution Admin Interface</div>
    </div>

    <script src="js/base.js"></script>
    <script src="js/boot.js"></script>
    <script src="js/tabs.js"></script>
    <script src="js/state.js"></script>
    <script src="js/tooltips.js"></script>
    <script src="js/clock.js"></script>
    <script src="js/setup_wizard.js"></script>
    <script src="js/confirm_modal.js"></script>
    <script src="js/safety.js"></script>
    <script src="js/power_ui.js"></script>
    <script src="js/user_menu.js"></script>
    <script src="js/outputs.js"></script>
    <script src="js/lt_toggle.js"></script>
    <script src="js/manual_outputs.js"></script>
    <script src="js/system_commands.js"></script>
    <script src="js/heartbeat.js"></script>
    <script src="js/control_api.js"></script>
    <script src="js/device_settings.js"></script>
    <script src="js/load_controls.js"></script>
    <script src="js/user_settings.js"></script>
    <script src="js/admin_settings.js"></script>
    <script src="js/wifi_settings.js"></script>
    <script src="js/live_overlay.js"></script>
    <script src="js/session_events.js"></script>
    <script src="js/calibration_ui.js"></script>
    <script src="js/calibration_actions.js"></script>
    <script src="js/wire_test.js"></script>
    <script src="js/calibration_data.js"></script>
    <script src="js/calibration_chart.js"></script>
    <script src="js/live_control.js"></script>
    <script src="js/monitor_gauges.js"></script>
    <script src="js/logout.js"></script>
    <script src="js/init.js"></script>
    <script src="js/exports.js"></script>

    <!-- Confirm dialog -->
    <div id="confirmModal" class="user-modal">
      <div class="user-modal-content zoom-box">
        <h3 id="confirmTitle">Confirm Action</h3>
        <p id="confirmMessage">Are you sure?</p>

        <div class="user-modal-actions">
          <button id="confirmCancelBtn">Cancel</button>
          <button id="confirmOkBtn" class="danger">Yes, do it</button>
        </div>
      </div>
    </div>
  </body>
</html>
